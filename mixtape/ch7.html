<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Panel Data | Causal Inference</title>
<meta name="author" content="Scott Cunningham">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><style>
    @import url('https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,700;1,300&display=swap');
    </style>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/toc.css">
<link rel="stylesheet" href="css/causal_inference_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="&lt;i&gt;The Mixtape&lt;/i&gt;"><span style="font-weight:bold">Causal Inference</span></a>:
        <small class="text-muted"><i>The Mixtape</i></small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="ch1.html"><span class="header-section-number">2</span> Probability and Regression Review</a></li>
<li><a class="" href="ch2.html"><span class="header-section-number">3</span> Directed Acyclic Graphs</a></li>
<li><a class="" href="ch3.html"><span class="header-section-number">4</span> Potential Outcomes Causal Model</a></li>
<li><a class="" href="ch4.html"><span class="header-section-number">5</span> Matching and Subclassification</a></li>
<li><a class="" href="ch5.html"><span class="header-section-number">6</span> Regression Discontinuity</a></li>
<li><a class="" href="ch6.html"><span class="header-section-number">7</span> Instrumental Variables</a></li>
<li><a class="active" href="ch7.html"><span class="header-section-number">8</span> Panel Data</a></li>
<li><a class="" href="ch8.html"><span class="header-section-number">9</span> Difference-in-Differences</a></li>
<li><a class="" href="ch9.html"><span class="header-section-number">10</span> Synthetic Control</a></li>
<li><a class="" href="ch10.html"><span class="header-section-number">11</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/scunning1975/mixtape">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ch7" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Panel Data<a class="anchor" aria-label="anchor" href="#ch7"><i class="fas fa-link"></i></a>
</h1>
<div class="cover-box">
<div class="row">
    <div class="col-xs-8 col-md-4 cover-img">
        <a href="https://www.amazon.com/dp/0300251688"><img src="images/cover.jpg" alt="Buy Today!"></a>
    </div>
    
    <div class="col-xs-12 col-md-8 cover-text-box">
            <h2> 
                Causal Inference: 
                <br><span style="font-style: italic; font-weight:bold; font-size: 20px;">The Mixtape.</span>
            </h2> 
            
        <div class="cover-text">
            <p>Buy the print version today:</p>
            
            <div class="chips">
                <a href="https://www.amazon.com/dp/0300251688" class="app-chip"> 
                    <i class="fab fa-amazon" aria-hidden="true"></i> Buy from Amazon 
                </a>
    
                <a href="https://yalebooks.yale.edu/book/9780300251685/causal-inference" class="app-chip"> 
                    <i class="fas fa-book" aria-hidden="true"></i> Buy from Yale Press 
                </a>
            </div>
        </div>
    </div>
</div>
</div>
<p>One of the most important tools in the causal inference toolkit is the panel data estimator. The estimators are designed explicitly for longitudinal data—the repeated observing of a unit over time. Under certain situations, repeatedly observing the same unit over time can overcome a particular kind of omitted variable bias, though not all kinds. While it is possible that observing the same unit over time will not resolve the bias, there are still many applications where it can, and that’s why this method is so important. We review first the DAG describing just such a situation, followed by discussion of a paper, and then present a data set exercise in R and Stata.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;There’s a second reason to learn this estimator. Some of these estimators, such as linear models with time and unit fixed effects, are the modal estimators used in difference-in-differences.&lt;/p&gt;"><sup>129</sup></a></p>
<div id="dag-example" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> DAG Example<a class="anchor" aria-label="anchor" href="#dag-example"><i class="fas fa-link"></i></a>
</h2>
<p>Before I dig into the technical assumptions and estimation methodology for panel data techniques, I want to review a simple DAG illustrating those assumptions. This DAG comes from <span class="citation">Imai and Kim (<a href="references.html#ref-Imai2017" role="doc-biblioref">2017</a>)</span>. Let’s say that we have data on a column of outcomes <span class="math inline">\(Y_i\)</span>, which appear in three time periods. In other words, <span class="math inline">\(Y_{i1}\)</span>, <span class="math inline">\(Y_{i2}\)</span>, and <span class="math inline">\(Y_{i3}\)</span> where <span class="math inline">\(i\)</span> indexes a particular unit and <span class="math inline">\(t=1,2,3\)</span> index the time period where each <span class="math inline">\(i\)</span> unit is observed. Likewise, we have a matrix of covariates, <span class="math inline">\(D_i\)</span>, which also vary over time—<span class="math inline">\(D_{i1}\)</span>, <span class="math inline">\(D_{i2}\)</span>, and <span class="math inline">\(D_{i3}\)</span>. And finally, there exists a single unit-specific unobserved variable, <span class="math inline">\(u_i\)</span>, which varies across units, but which does not vary over time for that unit. Hence the reason that there is no <span class="math inline">\(t=1,2,3\)</span> subscript for our <span class="math inline">\(u_i\)</span> variable. Key to this variable is (a) it is unobserved in the data set, (b) it is unit-specific, and (c) it does not change over time for a given unit <span class="math inline">\(i\)</span>. Finally there exists some unit-specific time-invariant variable, <span class="math inline">\(X_i\)</span>. Notice that it doesn’t change over time, just <span class="math inline">\(u_i\)</span>, but unlike <span class="math inline">\(u_i\)</span> it is observed.</p>
<div class="inline-figure"><img src="causal_inference_mixtape_files/figure-html/panel_data_dag-1.png" width="50%" style="display: block; margin: auto;"></div>
<p>As this is the busiest DAG we’ve seen so far, it merits some discussion. First, let us note that <span class="math inline">\(D_{i1}\)</span> causes both <span class="math inline">\(Y_{i1}\)</span> as well as the next period’s treatment value, <span class="math inline">\(D_{i2}\)</span>. Second, note that an unobserved confounder, <span class="math inline">\(u_i\)</span>, determines all <span class="math inline">\(Y\)</span> and <span class="math inline">\(D\)</span> variables. Consequently, <span class="math inline">\(D\)</span> is endogenous since <span class="math inline">\(u_i\)</span> is unobserved and absorbed into the structural error term of the regression model. Thirdly, there is <em>no</em> time-varying unobserved confounder correlated with <span class="math inline">\(D_{it}\)</span>—the only confounder is <span class="math inline">\(u_i\)</span>, which we call the unobserved heterogeneity. Fourth, past outcomes do not directly affect current outcomes (i.e., no direct edge between the <span class="math inline">\(Y_{it}\)</span> variables). Fifth, past outcomes do not directly affect current treatments (i.e., no direct edge from <span class="math inline">\(Y_{i, t-1}\)</span> to <span class="math inline">\(D_{it}\)</span>). And finally, past treatments, <span class="math inline">\(D_{i,t-1}\)</span> do not directly affect current outcomes, <span class="math inline">\(Y_{it}\)</span> (i.e., no direct edge from <span class="math inline">\(D_{i,t-1}\)</span> and <span class="math inline">\(Y_{it}\)</span>). It is under these assumptions that we can use a particular panel method called <em>fixed effects</em> to isolate the causal effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(Y\)</span>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The fixed-effects estimator, when it includes year fixed effects, is popularly known as the “twoway fixed effects” estimator.&lt;/p&gt;"><sup>130</sup></a></p>
<p>What might an example of this be? Let’s return to our story about the returns to education. Let’s say that we are interested in the effect of schooling on earnings, and schooling is partly determined by unchanging genetic factors which themselves determine unobserved ability, like intelligence, contentiousness, and motivation <span class="citation">(Conley and Fletcher <a href="references.html#ref-Conley2017" role="doc-biblioref">2017</a>)</span>. If we observe the same people’s time-varying earnings and schoolings over time, then if the situation described by the above DAG describes both the directed edges and <em>the missing edges</em>, then we can use panel fixed effects models to identify the causal effect of schooling on earnings.</p>
</div>
<div id="estimation" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Estimation<a class="anchor" aria-label="anchor" href="#estimation"><i class="fas fa-link"></i></a>
</h2>
<p>When we use the term “panel data,” what do we mean? We mean a data set where we observe the same units (e.g., individuals, firms, countries, schools) over more than one time period. Often our outcome variable depends on several factors, some of which are observed and some of which are unobserved in our data, and insofar as the unobserved variables are correlated with the treatment variable, then the treatment variable is endogenous and correlations are not estimates of a causal effect. This chapter focuses on the conditions under which a correlation between <span class="math inline">\(D\)</span> and <span class="math inline">\(Y\)</span> reflects a causal effect even with unobserved variables that are correlated with the treatment variable. Specifically, if these omitted variables are <em>constant</em> over time, then even if they are heterogeneous across units, we can use panel data estimators to consistently estimate the effect of our treatment variable on outcomes.</p>
<p>There are several different kinds of estimators for panel data, but we will in this chapter only cover two: pooled ordinary least squares (POLS) and fixed effects (FE).<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;A common third type of panel estimator is the random effects estimator, but in my experience, I have used it less often than fixed effects, so I decided to omit it. Again, this is not because it is unimportant. I just have chosen to do fewer things in more detail based on whether I think they qualify as the most common methods used in the present period by applied empiricists. See &lt;span class="citation"&gt;Wooldridge (&lt;a href="references.html#ref-Wooldridge2010" role="doc-biblioref"&gt;2010&lt;/a&gt;)&lt;/span&gt; for a more comprehensive treatment, though, of all panel methods including random effects.&lt;/p&gt;'><sup>131</sup></a></p>
<p>First we need to set up our notation. With some exceptions, panel methods are usually based on the traditional notation and not the potential outcomes notation.</p>
<p>Let <span class="math inline">\(Y\)</span> and <span class="math inline">\(D\equiv(D_1, D_2, \dots, D_k)\)</span> be observable random variables and <span class="math inline">\(u\)</span> be an unobservable random variable. We are interested in the partial effects of variable <span class="math inline">\(D_j\)</span> in the population regression function:
<span class="math display">\[
E\big[Y\mid D_1,D_2, \dots , D_k, u\big]
\]</span>
We observe a sample of <span class="math inline">\(i=1,2,\dots,N\)</span> cross-sectional units for <span class="math inline">\(t=1,2,\dots,T\)</span> time periods (a balanced panel). For each unit <span class="math inline">\(i\)</span>, we denote the observable variables for all time periods as <span class="math inline">\(\{(Y_{it},D_{it}):t=1,2,\dots,T\}\)</span>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;For simplicity, I’m ignoring the time-invariant observations, &lt;span class="math inline"&gt;\(X_i\)&lt;/span&gt; from our DAG for reasons that will hopefully soon be made clear.&lt;/p&gt;'><sup>132</sup></a> Let <span class="math inline">\(D_{it}\equiv(D_{it1},D_{it2}, \dots, D_{itk})\)</span> be a <span class="math inline">\(1\times K\)</span> vector. We typically assume that the actual cross-sectional units (e.g., individuals in a panel) are identical and independent draws from the population in which case <span class="math inline">\(\{Y_i, D_i, u_i\}^N_{i=1}\sim i.i.d.\)</span>, or cross-sectional independence. We describe the main observables, then, as <span class="math inline">\(Y_i \equiv (Y_{i1}, Y_{i2}, \dots, Y_{iT})'\)</span> and <span class="math inline">\(D_i \equiv (D_{i1},D_{i2}, \dots, D_{iT})\)</span>.</p>
<p>It’s helpful now to illustrate the actual stacking of individual units across their time periods. A single unit <span class="math inline">\(i\)</span> will have multiple time periods <span class="math inline">\(t\)</span>
<span class="math display">\[
Y_i=\left( \begin{array}{c}
   Y_{i1} \\
   \vdots \\
   Y_{it} \\
   \vdots \\
   Y_{iT}
   \end{array} \right)_{T\times 1}
   \qquad
   D_i = \left( \begin{array}{ccccc}
   D_{i,1,1} &amp; D_{i,1,2} &amp; D_{i,1,j} &amp; \dots &amp; D_{i,1,K}
   \\
   \vdots &amp; \vdots &amp; \vdots &amp; &amp; \vdots
   \\
   D_{i,t,1} &amp; D_{i,t,2} &amp; D_{i,t,j} &amp; \dots &amp; D_{i,t,K}
   \\
   \vdots &amp; \vdots &amp; \vdots &amp; &amp; \vdots \\
   D_{i,T,1} &amp; D_{i,T,2} &amp; D_{i,T,j} &amp; \dots &amp; D_{i,T,K}
   \end{array} \right)_{T\times K}
\]</span>
And the entire panel itself with all units included will look like this:
<span class="math display">\[
Y = \left( \begin{array}{c}
   Y_{1} \\
   \vdots \\
   Y_{i} \\
   \vdots \\
   Y_{N}
   \end{array} \right)_{NT\times 1}
   \qquad
   D = \left( \begin{array}{c}
   D_1 \\
   \vdots \\
   D_i \\
   \vdots \\
   D_N
   \end{array} \right)_{NT \times K}
\]</span>
For a randomly drawn cross-sectional unit <span class="math inline">\(i\)</span>, the model is given by
<span class="math display">\[
Y_{it}=\delta D_{it}+u_i+\varepsilon_{it},
   \quad t=1,2,\dots,T
\]</span>
As always, we use our schooling-earnings example for motivation. Let <span class="math inline">\(Y_{it}\)</span> be log earnings for a person <span class="math inline">\(i\)</span> in year <span class="math inline">\(t\)</span>. Let <span class="math inline">\(D_{it}\)</span> be schooling for person <span class="math inline">\(i\)</span> in year <span class="math inline">\(t\)</span>. Let <span class="math inline">\(\delta\)</span> be the returns to schooling. Let <span class="math inline">\(u_i\)</span> be the sum of all time-invariant person-specific characteristics, such as unobserved ability. This is, as I said earlier, often called the <em>unobserved heterogeneity</em>. And let <span class="math inline">\(\varepsilon_{it}\)</span> be the time-varying unobserved factors that determine a person’s wage in a given period. This is often called the idiosyncratic error. We want to know what happens when we regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span>.</p>
<div id="pooled-ols" class="section level3" number="8.2.1">
<h3>
<span class="header-section-number">8.2.1</span> Pooled OLS<a class="anchor" aria-label="anchor" href="#pooled-ols"><i class="fas fa-link"></i></a>
</h3>
<p>The first estimator we will discuss is the pooled ordinary least squares, or POLS estimator. When we ignore the panel structure and regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> we get
<span class="math display">\[
Y_{it}=\delta D_{it} + \eta_{it};
   \quad
   t=1,2,\dots,T
\]</span>
with composite error <span class="math inline">\(\eta_{it} \equiv c_i + \varepsilon_{it}\)</span>. The main assumption necessary to obtain consistent estimates for <span class="math inline">\(\delta\)</span> is:
<span class="math display">\[
E\big[\eta_{it}\mid D_{i1},D_{i2}, \dots, D_{iT}\big] = E\big[\eta_{it}\mid D_{it}\big] = 0
   \quad
   \text{for $t=1,2,\dots, T$}
\]</span>
While our DAG did not include <span class="math inline">\(\varepsilon_{it}\)</span>, this would be equivalent to assuming that the unobserved heterogeneity, <span class="math inline">\(c_i\)</span>, was uncorrelated with <span class="math inline">\(D_{it}\)</span> for all time periods.</p>
<p>But this is not an appropriate assumption in our case because our DAG explicitly links the unobserved heterogeneity to both the outcome and the treatment in each period. Or using our schooling-earnings example, schooling is likely based on unobserved background factors, <span class="math inline">\(u_i\)</span>, and therefore without controlling for it, we have omitted variable bias and <span class="math inline">\(\widehat{\delta}\)</span> is biased. No correlation between <span class="math inline">\(D_{it}\)</span> and <span class="math inline">\(\eta_{it}\)</span> <em>necessarily means</em> no correlation between the unobserved <span class="math inline">\(u_i\)</span> and <span class="math inline">\(D_{it}\)</span> for all <span class="math inline">\(t\)</span> and that is just probably not a credible assumption. An additional problem is that <span class="math inline">\(\eta_{it}\)</span> is serially correlated for unit <span class="math inline">\(i\)</span> since <span class="math inline">\(u_i\)</span> is present in each <span class="math inline">\(t\)</span> period. And thus heteroskedastic robust standard errors are also likely too small.</p>
</div>
<div id="fixed-effects-within-estimator" class="section level3" number="8.2.2">
<h3>
<span class="header-section-number">8.2.2</span> Fixed effects (within Estimator)<a class="anchor" aria-label="anchor" href="#fixed-effects-within-estimator"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s rewrite our unobserved effects model so that this is still firmly in our minds:
<span class="math display">\[
Y_{it} = \delta D_{it} + u_i + \varepsilon_{it};
   \quad
   t=1,2,\dots,T
\]</span>
If we have data on multiple time periods, we can think of <span class="math inline">\(u_i\)</span> as fixed effects to be estimated. OLS estimation with fixed effects yields
<span class="math display">\[
\big(\widehat{\delta}, \widehat{u}_1, \dots, \widehat{u}_N\big) = \underset{b,m_1,\dots,m_N}{\arg\min} \sum_{i=1}^N\sum_{t=1}^T (Y_{it}-D_{it}b- m_i)^2
\]</span>
which amounts to including <span class="math inline">\(N\)</span> individual dummies in regression of <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span>.</p>
<p>The first-order conditions (FOC) for this minimization problem are:
<span class="math display">\[
\sum_{i=1}^N \sum_{t=1}^T D_{it}'
   \big(Y_{it} - D_{it}\widehat{\delta} - \widehat{u}_i\big)=0
\]</span>
and
<span class="math display">\[
\sum_{t=1}^T\big(Y_{it} - D_{it}\widehat{\delta} - \widehat{u}_i\big)=0
\]</span>
for <span class="math inline">\(i=1,\dots,N\)</span>.</p>
<p>Therefore, for <span class="math inline">\(i=1, \dots, N\)</span>,
<span class="math display">\[
\widehat{u}_i = \dfrac{1}{T} \sum_{t=1}^T\big(Y_{it}-D_{it}\widehat{\delta}\big)=
   \overline{Y}_i-\overline{D}_i\widehat{\delta},
\]</span>
where
<span class="math display">\[
\overline{D}_i \equiv \dfrac{1}{T}\sum_{t=1}^TD_{it}; \bar{Y}_i \equiv \dfrac{1}{T} \sum_{t=1}^T Y_{it}
\]</span>
Plug this result into the first FOC to obtain:
<span class="math display">\[
\begin{gathered}
   \widehat{\delta} = \bigg( \sum_{i=1}^N \sum_{t=1}^T (D_{it} - \overline{D}_i)'(D_{it} - \overline{D}_i) \bigg)^{-1} \bigg( \sum_{i=1}^N \sum_{t=1}^T (D_{it} - \overline{D}_i)'(Y_{it} - \overline{Y})\bigg)
   \\
   \widehat{\delta} = \bigg(\sum_{i=1}^N \sum_{t=1}^T \ddot{D}_{it}'\ddot{D}_{it} \bigg)^{-1} \bigg( \sum_{i=1}^N \sum_{t=1}^T \ddot{D}_{it}' \ddot{D}_{it} \bigg)\end{gathered}
\]</span>
with time-demeaned variables <span class="math inline">\(\ddot{D}_{it} \equiv D_{it}-\overline{D},\ddot{Y}_{it} \equiv Y_{it} - \overline{Y}_i\)</span>.</p>
<p>In case it isn’t clear, though, running a regression with the time-demeaned variables <span class="math inline">\(\ddot{Y}_{it}\equiv Y_{it} - \overline{Y}_i\)</span> and <span class="math inline">\(\ddot{D}_{it} \equiv D_{it} - \overline{D}\)</span> is <em>numerically equivalent</em> to a regression of <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> and unit-specific dummy variables. Hence the reason this is sometimes called the “within” estimator, and sometimes called the “fixed effects” estimator. And when year fixed effects are included, the “twoway fixed effects” estimator. They are the same thing.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;One of the things you’ll find over time is that things have different names, depending on the author and tradition, and those names are often completely uninformative.&lt;/p&gt;"><sup>133</sup></a></p>
<p>Even better, the regression with the time-demeaned variables is consistent for <span class="math inline">\(\delta\)</span> even when <span class="math inline">\(C[D_{it},u_i]\ne 0\)</span> because time-demeaning eliminates the unobserved effects. Let’s see this now:</p>
<p><span class="math display">\[\begin{align}
   Y_{it}   &amp; =\delta D_{it} + u_i + \varepsilon_{it}                                                             
   \\
   \overline{Y}_i            &amp; =\delta \overline{D}_i + u_i + \overline{\varepsilon}_{i}                                           
   \\
   (Y_{it} - \overline{Y}_i) &amp; =(\delta D_{it} - \delta\overline{D}) + (u_i - u_i) + (\varepsilon_{it} - \overline{\varepsilon}_i) 
   \\
   \ddot{Y}_{it}             &amp; =\delta\ddot{D}_{it}+\ddot{\varepsilon}_{it}                                                        
\end{align}\]</span></p>
<p>Where’d the unobserved heterogeneity go?! It was deleted when we time-demeaned the data. And as we said, including individual fixed effects does this time demeaning automatically so that you don’t have to go to the actual trouble of doing it yourself manually.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Though feel free to do it if you want to convince yourself that they are numerically equivalent, probably just starting with a bivariate regression for simplicity.&lt;/p&gt;"><sup>134</sup></a></p>
<p>So how do we precisely do this form of estimation? There are three ways to implement the fixed effects (within) estimator. They are:</p>
<ol style="list-style-type: decimal">
<li><p>Demean and regress <span class="math inline">\(\ddot{Y}_{it}\)</span> on <span class="math inline">\(\ddot{D}_{it}\)</span> (need to correct degrees of freedom).</p></li>
<li><p>Regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> and unit dummies (dummy variable regression).</p></li>
<li><p>Regress <span class="math inline">\(Y_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> with canned fixed effects routine in Stata or R.</p></li>
</ol>
<p>Later in this chapter, I will review an example from my research. We will estimate a model involving sex workers using pooled OLS, a FE, and a demeaned OLS model. I’m hoping this exercise will help you see the similarities and differences across all three approaches.</p>
</div>
<div id="identifying-assumptions-1" class="section level3" number="8.2.3">
<h3>
<span class="header-section-number">8.2.3</span> Identifying Assumptions<a class="anchor" aria-label="anchor" href="#identifying-assumptions-1"><i class="fas fa-link"></i></a>
</h3>
<p>We kind of reviewed the assumptions necessary to identify <span class="math inline">\(\delta\)</span> with our fixed effects (within) estimator when we walked through that original DAG, but let’s supplement that DAG intuition with some formality. The main identification assumptions are:</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(E[\varepsilon_{it}\mid D_{i1}, D_{i2}, \dots, D_{iT}, u_i]=0; t=1,2,\dots,T\)</span></p></li>
<li><p>This means that the regressors are strictly exogenous conditional on the unobserved effect. This allows <span class="math inline">\(D_{it}\)</span> to be arbitrarily related to <span class="math inline">\(u_i\)</span>, though. It only concerns the relationship between <span class="math inline">\(D_{it}\)</span> and <span class="math inline">\(\varepsilon_{it}\)</span>, not <span class="math inline">\(D_{it}\)</span>’s relationship to <span class="math inline">\(u_i\)</span>.</p></li>
<li><p><span class="math inline">\(rank\bigg( \sum_{t=1}^T E[\ddot{D}_{it}'\ddot{D}_{it}]\bigg) = K\)</span></p></li>
<li><p>It shouldn’t be a surprise to you by this point that we have a rank condition, because even when we were working with the simpler linear models, the estimated coefficient was always a scaled covariance, where the scaling was by a variance term. Thus regressors must vary over time for at least some <span class="math inline">\(i\)</span> and not be collinear in order that <span class="math inline">\(\widehat{\delta} \approx \delta\)</span>.</p></li>
</ol>
<p>The properties of the estimator under assumptions 1 and 2 are that <span class="math inline">\(\widehat{\delta}_{FE}\)</span> is consistent (<span class="math inline">\(\underset{N\rightarrow \infty}{p\lim}\ \widehat{\delta}_{FE,N}=\delta\)</span>) and <span class="math inline">\(\widehat{\delta}_{FE}\)</span> is unbiased conditional on D.</p>
<p>I only briefly mention inference. But the standard errors in this framework must be “clustered” by panel unit (e.g., individual) to allow for correlation in the <span class="math inline">\(\varepsilon_{it}\)</span> for the same person <span class="math inline">\(i\)</span> over time. This yields valid inference so long as the number of clusters is “large.”<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;In my experience, when an econometrician is asked how large is large, they say “the size of your data.” But that said, there is a small clusters literature and usually it’s thought that fewer than thirty clusters is too small (as a rule of thumb). So it may be that having around thirty to forty clusters is sufficient for the approaching of infinity. This will usually hold in most panel applications such as US states or individuals in the NSLY, etc.&lt;/p&gt;"><sup>135</sup></a></p>
</div>
<div id="caveat-1-fixed-effects-cannot-solve-reverse-causality" class="section level3" number="8.2.4">
<h3>
<span class="header-section-number">8.2.4</span> Caveat #1: Fixed effects cannot solve reverse causality<a class="anchor" aria-label="anchor" href="#caveat-1-fixed-effects-cannot-solve-reverse-causality"><i class="fas fa-link"></i></a>
</h3>
<p>But, there are still things that fixed effects (within) estimators cannot solve. For instance, let’s say we regressed crime rates onto police spending per capita. <span class="citation">Becker (<a href="references.html#ref-Becker1968" role="doc-biblioref">1968</a>)</span> argues that increases in the probability of arrest, usually proxied by police per capita or police spending per capita, will reduce crime. But at the same time, police spending per capita is itself a function of crime rates. This kind of reverse causality problem shows up in most panel models when regressing crime rates onto police. For instance, see <span class="citation">Cornwell and Trumbull (<a href="references.html#ref-Cornwell1994" role="doc-biblioref">1994</a>)</span>. I’ve reproduced a portion of this in Table <a href="ch7.html#tab:police-crime1">8.1</a>. The dependent variable is crime rates by county in North Carolina for a panel, and they find a <em>positive</em> correlation between police and crime rates, which is the opposite of what Becker predicts. Does this mean having more police in an area <em>causes</em> higher crime rates? Or does it likely reflect the reverse causality problem?</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:police-crime1">Table 8.1: </span> Panel estimates of police on crime</caption>
<thead><tr class="header">
<th align="left">Dependent variable</th>
<th align="center">Between</th>
<th align="center">Within</th>
<th align="center">2SLS (FE)</th>
<th align="center">2SLS (No FE)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Police</td>
<td align="center">0.364</td>
<td align="center">0.413</td>
<td align="center">0.504</td>
<td align="center">0.419</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.060)</td>
<td align="center">(0.027)</td>
<td align="center">(0.617)</td>
<td align="center">(0.218)</td>
</tr>
<tr class="odd">
<td align="left">Controls</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
</tr>
</tbody>
</table></div>
<p class="footnote">
North Carolina county level data. Standard errors in parenthesis.
</p>
<p>So, one situation in which you wouldn’t want to use panel fixed effects is if you have reverse causality or simultaneity bias. And specifically when that reverse causality is very strong in observational data. This would technically violate the DAG, though, that we presented at the start of the chapter. Notice that if we had reverse causality, then <span class="math inline">\(Y \rightarrow D\)</span>, which is explicitly ruled out by this theoretical model contained in the DAG. But obviously, in the police—crime example, that DAG would be inappropriate, and any amount of reflection on the problem should tell you that that DAG is inappropriate. Thus it requires, as I’ve said repeatedly, some careful reflection, and writing out exactly what the relationship is between the treatment variables and the outcome variables in a DAG can help you develop a credible identification strategy.</p>
</div>
<div id="caveat-2-fixed-effects-cannot-address-time-variant-unobserved-heterogeneity" class="section level3" number="8.2.5">
<h3>
<span class="header-section-number">8.2.5</span> Caveat #2: Fixed effects cannot address time-variant unobserved heterogeneity<a class="anchor" aria-label="anchor" href="#caveat-2-fixed-effects-cannot-address-time-variant-unobserved-heterogeneity"><i class="fas fa-link"></i></a>
</h3>
<p>The second situation in which panel fixed effects don’t buy you anything is if the unobserved heterogeneity is time-varying. In this situation, the demeaning has simply demeaned an unobserved time-variant variable, which is then moved into the composite error term, and which since time-demeaned <span class="math inline">\(\ddot{u}_{it}\)</span> correlated with <span class="math inline">\(\ddot{D}_{it}\)</span>, <span class="math inline">\(\ddot{D}_{it}\)</span> remains endogenous. Again, look carefully at the DAG—panel fixed effects are only appropriate if <span class="math inline">\(u_i\)</span> is unchanging. Otherwise it’s just another form of omitted variable bias. So, that said, don’t just blindly use fixed effects and think that it solves your omitted variable bias problem—in the same way that you shouldn’t use matching just because it’s convenient to do. You need a DAG, based on an actual economic model, which will allow you to build the appropriate research design. Nothing substitutes for careful reasoning and economic theory, as they are the necessary conditions for good research design.</p>
</div>
<div id="returns-to-marriage-and-unobserved-heterogeneity" class="section level3" number="8.2.6">
<h3>
<span class="header-section-number">8.2.6</span> Returns to marriage and unobserved heterogeneity<a class="anchor" aria-label="anchor" href="#returns-to-marriage-and-unobserved-heterogeneity"><i class="fas fa-link"></i></a>
</h3>
<p>When might this be true? Let’s use an example from <span class="citation">Cornwell and Rupert (<a href="references.html#ref-Cornwell1997" role="doc-biblioref">1997</a>)</span> in which the authors attempt to estimate the causal effect of marriage on earnings. It’s a well-known stylized fact that married men earn more than unmarried men, even controlling for observables. But the question is whether that correlation is causal, or whether it reflects unobserved heterogeneity (i.e., selection bias).</p>
<p>So let’s say that we had panel data on individuals. These individuals <span class="math inline">\(i\)</span> are observed for four periods <span class="math inline">\(t\)</span>. We are interested in the following equation:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;We use the same notation as used in their paper, as opposed to the &lt;span class="math inline"&gt;\(\ddot{Y}\)&lt;/span&gt; notation presented earlier.&lt;/p&gt;'><sup>136</sup></a>
<span class="math display">\[
Y_{it}=\alpha+\delta M_{it}+\beta X_{it}+A_{i} +\gamma_i+\varepsilon_{it}
\]</span>
Let the outcome be their wage <span class="math inline">\(Y_{it}\)</span> observed in each period, and which changes each period. Let wages be a function of marriage. Since people’s marital status changes over time, the marriage variable is allowed to change value over time. But race and gender, in most scenarios, do not ordinarily change over time; these are variables which are ordinarily unchanging, or what you may sometimes hear called “time invariant.” Finally, the variables <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\gamma_i\)</span> are variables which are unobserved, vary cross-sectionally across the sample, but do not vary over time. I will call these measures of unobserved ability, which may refer to any fixed endowment in the person, like fixed cognitive ability or noncognitive ability such as “grit.” The key here is that it is unit-specific, unobserved, and time-invariant. The <span class="math inline">\(\varepsilon_{it}\)</span> is the unobserved determinants of wages which are assumed to be uncorrelated with marriage and other covariates.</p>
<p><span class="citation">Cornwell and Rupert (<a href="references.html#ref-Cornwell1997" role="doc-biblioref">1997</a>)</span> estimate both a feasible generalized least squares model and three fixed effects models (each of which includes different time-varying controls). The authors call the fixed effects regression a “within” estimator, because it uses the within unit variation for eliminating the confounding. Their estimates are presented in Table <a href="ch7.html#tab:marriage-returns">8.2</a>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:marriage-returns">Table 8.2: </span> Estimated wage regressions</caption>
<thead><tr class="header">
<th align="left">Dependent variable</th>
<th align="center">FGLS</th>
<th align="center">Within</th>
<th align="center">Within</th>
<th align="center">Within</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Married</td>
<td align="center">0.083</td>
<td align="center">0.056</td>
<td align="center">0.051</td>
<td align="center">0.033</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.022)</td>
<td align="center">(0.026)</td>
<td align="center">(0.026)</td>
<td align="center">(0.028)</td>
</tr>
<tr class="odd">
<td align="left">Education controls</td>
<td align="center">Yes</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="left">Tenure</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">Yes</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="left">Quadratics in years married</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">No</td>
<td align="center">Yes</td>
</tr>
</tbody>
</table></div>
<p class="footnote">
Standard errors in parenthesis.
</p>
<p>Notice that the FGLS (column 1) finds a strong marriage premium of around 8.3%. But, once we begin estimating fixed effects models, the effect gets smaller and less precise. The inclusion of marriage characteristics, such as years married and job tenure, causes the coefficient on marriage to fall by around 60% from the FGLS estimate, and is no longer statistically significant at the 5% level.</p>
</div>
</div>
<div id="data-exercise-survey-of-adult-service-providers" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Data Exercise: Survey of Adult Service Providers<a class="anchor" aria-label="anchor" href="#data-exercise-survey-of-adult-service-providers"><i class="fas fa-link"></i></a>
</h2>
<p>Next I’d like to introduce a Stata exercise based on data collection for my own research: a survey of sex workers. You may or may not know this, but the Internet has had a profound effect on sex markets. It has moved sex work indoors while simultaneously breaking the traditional link between sex workers and pimps. It has increased safety and anonymity, too, which has had the effect of causing new entrants. The marginal sex worker has more education and better outside options than traditional US sex workers <span class="citation">(Cunningham and Kendall <a href="references.html#ref-Cunningham2011" role="doc-biblioref">2011</a>, <a href="references.html#ref-Cunningham2014a" role="doc-biblioref">2014</a>, <a href="references.html#ref-Cunningham2016b" role="doc-biblioref">2016</a>)</span>. The Internet, in sum, caused the marginal sex worker to shift towards women more sensitive to detection, harm, and arrest.</p>
<p>In 2008 and 2009, I surveyed (with Todd Kendall) approximately 700 US Internet-mediated sex workers. The survey was a basic labor-market survey; I asked them about their illicit and legal labor-market experiences, and about demographics. The survey had two parts: a “static” provider-specific section and a “panel” section. The panel section asked respondents to share information about each of the previous four sessions with clients.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Technically, I asked them to share about the last five sessions, but for this exercise, I have dropped the fifth due to low response rates on the fifth session.&lt;/p&gt;"><sup>137</sup></a></p>
<p>I have created a shortened version of the data set and uploaded it to Github. It includes a few time-invariant provider characteristics, such as race, age, marital status, years of schooling, and body mass index, as well as several time-variant session-specific characteristics including the log of the hourly price, the log of the session length (in hours), characteristics of the client himself, whether a condom was used in any capacity during the session, whether the client was a “regular,” etc.</p>
<p>In this exercise, you will estimate three types of models: a pooled OLS model, a fixed effects (FE), and a demeaned OLS model. The model will be of the following form:</p>
<p><span class="math display">\[\begin{align}
   Y_{is}        &amp; =\beta_i X_i + \gamma_{is} Z_{is} + u_i + \varepsilon_{is} 
   \\
   \ddot{Y}_{is} &amp; = \gamma_{is} \ddot{Z}_{is} + \ddot \eta_{is}              
\end{align}\]</span></p>
<p>where <span class="math inline">\(u_i\)</span> is both unobserved and correlated with <span class="math inline">\(Z_{is}\)</span>.</p>
<p>The first regression model will be estimated with pooled OLS and the second model will be estimated using both fixed effects and OLS. In other words, I’m going to have you estimate the model using canned routines in Stata and R with individual fixed effects, as well as demean the data manually and estimate the demeaned regression using OLS.</p>
<p>Notice that the second regression has a different notation on the dependent and independent variable; it represents the fact that the variables are columns of <em>demeaned</em> variables. Thus <span class="math inline">\(\ddot Y_{is} = Y_{is} - \overline{Y}_i\)</span>. Secondly, notice that the time-invariant <span class="math inline">\(X_i\)</span> variables are missing from the second equation. Do you understand why that is the case? These variables have also been demeaned, but since the demeaning is across time, and since these time-invariant variables do not change over time, the demeaning deletes them from the expression. Notice, also, that the unobserved individual specific heterogeneity, <span class="math inline">\(u_i\)</span>, has disappeared. It has disappeared for the same reason that the <span class="math inline">\(X_i\)</span> terms are gone—because the mean of <span class="math inline">\(u_i\)</span> over time is itself, and thus the demeaning deletes it.</p>
<p>Let’s examine these models using the following R and Stata programs.</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/sasp.do"><code>sasp.do</code></a></em></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb83-1"><a href="ch7.html#cb83-1" aria-hidden="true"></a><span class="kw">use</span> https:<span class="co">//github.com/scunning1975/mixtape/raw/master/sasp_panel.dta, clear</span></span>
<span id="cb83-2"><a href="ch7.html#cb83-2" aria-hidden="true"></a><span class="kw">tsset</span> id session</span>
<span id="cb83-3"><a href="ch7.html#cb83-3" aria-hidden="true"></a><span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> lnw age asq bmi hispanic <span class="bn">black</span> other asian schooling cohab married divorced separated age_cl unsafe llength <span class="kw">reg</span> asq_cl appearance_cl provider_second asian_cl black_cl hispanic_cl othrace_cl hot massage_cl </span>
<span id="cb83-4"><a href="ch7.html#cb83-4" aria-hidden="true"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="ot">`x'</span>==.</span>
<span id="cb83-5"><a href="ch7.html#cb83-5" aria-hidden="true"></a><span class="kw">bysort</span> id: <span class="kw">gen</span> <span class="fu">s</span>=_N</span>
<span id="cb83-6"><a href="ch7.html#cb83-6" aria-hidden="true"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="fu">s</span>==4</span>
<span id="cb83-7"><a href="ch7.html#cb83-7" aria-hidden="true"></a><span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> lnw age asq bmi hispanic <span class="bn">black</span> other asian schooling cohab married divorced separated age_cl unsafe llength <span class="kw">reg</span> asq_cl appearance_cl provider_second asian_cl black_cl hispanic_cl  othrace_cl hot massage_cl </span>
<span id="cb83-8"><a href="ch7.html#cb83-8" aria-hidden="true"></a></span>
<span id="cb83-9"><a href="ch7.html#cb83-9" aria-hidden="true"></a><span class="kw">egen</span> mean_<span class="ot">`x'</span>=<span class="kw">mean</span>(<span class="ot">`x'</span>), <span class="kw">by</span>(id)</span>
<span id="cb83-10"><a href="ch7.html#cb83-10" aria-hidden="true"></a><span class="kw">gen</span> demean_<span class="ot">`x'</span>=<span class="ot">`x'</span> - mean_<span class="ot">`x'</span></span>
<span id="cb83-11"><a href="ch7.html#cb83-11" aria-hidden="true"></a><span class="kw">drop</span> <span class="kw">mean</span>*</span>
<span id="cb83-12"><a href="ch7.html#cb83-12" aria-hidden="true"></a></span>
<span id="cb83-13"><a href="ch7.html#cb83-13" aria-hidden="true"></a><span class="kw">xi</span>: <span class="kw">reg</span> lnw  age asq bmi hispanic <span class="bn">black</span> other asian schooling cohab married divorced separated age_cl unsafe llength <span class="kw">reg</span> asq_cl appearance_cl provider_second asian_cl black_cl hispanic_cl othrace_cl hot massage_cl, <span class="kw">robust</span></span>
<span id="cb83-14"><a href="ch7.html#cb83-14" aria-hidden="true"></a><span class="kw">xi</span>: <span class="kw">xtreg</span> lnw  age asq bmi hispanic <span class="bn">black</span> other asian schooling cohab married divorced separated age_cl unsafe llength <span class="kw">reg</span> asq_cl appearance_cl provider_second asian_cl black_cl hispanic_cl othrace_cl hot massage_cl, <span class="kw">fe</span> i(id) <span class="kw">robust</span></span>
<span id="cb83-15"><a href="ch7.html#cb83-15" aria-hidden="true"></a><span class="kw">reg</span> demean_lnw demean_age demean_asq demean_bmi demean_hispanic demean_black demean_other demean_asian demean_schooling demean_cohab demean_married demean_divorced demean_separated demean_age_cl demean_unsafe demean_llength demean_reg demean_asq_cl demean_appearance_cl demean_provider_second demean_asian_cl demean_black_cl demean_hispanic_cl demean_othrace_cl demean_hot demean_massage_cl, <span class="kw">robust</span> <span class="kw">cluster</span>(id)</span></code></pre></div>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/R/sasp.R"><code>sasp.R</code></a></em></p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haven.tidyverse.org">haven</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">estimatr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=plm">plm</a></span><span class="op">)</span>

<span class="va">read_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">full_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"https://raw.github.com/scunning1975/mixtape/master/"</span>, 
                     <span class="va">df</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html">read_dta</a></span><span class="op">(</span><span class="va">full_path</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">sasp</span> <span class="op">&lt;-</span> <span class="fu">read_data</span><span class="op">(</span><span class="st">"sasp_panel.dta"</span><span class="op">)</span>

<span class="co">#-- Delete all NA</span>
<span class="va">sasp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">sasp</span><span class="op">)</span>

<span class="co">#-- order by id and session </span>
<span class="va">sasp</span> <span class="op">&lt;-</span> <span class="va">sasp</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">session</span><span class="op">)</span>

<span class="co">#Balance Data</span>
<span class="va">balanced_sasp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/make.pbalanced.html">make.pbalanced</a></span><span class="op">(</span><span class="va">sasp</span>, 
                                balance.type <span class="op">=</span> <span class="st">"shared.individuals"</span><span class="op">)</span>

<span class="co">#Demean Data</span>
<span class="va">balanced_sasp</span> <span class="op">&lt;-</span> <span class="va">balanced_sasp</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span> 
  demean_lnw <span class="op">=</span> <span class="va">lnw</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">lnw</span>, <span class="va">id</span><span class="op">)</span>,
  demean_age <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">id</span><span class="op">)</span>,
  demean_asq <span class="op">=</span> <span class="va">asq</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">asq</span>, <span class="va">id</span><span class="op">)</span>,
  demean_bmi <span class="op">=</span> <span class="va">bmi</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">bmi</span>, <span class="va">id</span><span class="op">)</span>,
  demean_hispanic <span class="op">=</span> <span class="va">hispanic</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">hispanic</span>, <span class="va">id</span><span class="op">)</span>,
  demean_black <span class="op">=</span> <span class="va">black</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">black</span>, <span class="va">id</span><span class="op">)</span>,
  demean_other <span class="op">=</span> <span class="va">other</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">other</span>, <span class="va">id</span><span class="op">)</span>,
  demean_asian <span class="op">=</span> <span class="va">asian</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">asian</span>, <span class="va">id</span><span class="op">)</span>,
  demean_schooling <span class="op">=</span> <span class="va">schooling</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">schooling</span>, <span class="va">id</span><span class="op">)</span>,
  demean_cohab <span class="op">=</span> <span class="va">cohab</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">cohab</span>, <span class="va">id</span><span class="op">)</span>,
  demean_married <span class="op">=</span> <span class="va">married</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">married</span>, <span class="va">id</span><span class="op">)</span>,
  demean_divorced <span class="op">=</span> <span class="va">divorced</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">divorced</span>, <span class="va">id</span><span class="op">)</span>,
  demean_separated <span class="op">=</span> <span class="va">separated</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">separated</span>, <span class="va">id</span><span class="op">)</span>,
  demean_age_cl <span class="op">=</span> <span class="va">age_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">age_cl</span>, <span class="va">id</span><span class="op">)</span>,
  demean_unsafe <span class="op">=</span> <span class="va">unsafe</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">unsafe</span>, <span class="va">id</span><span class="op">)</span>,
  demean_llength <span class="op">=</span> <span class="va">llength</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">llength</span>, <span class="va">id</span><span class="op">)</span>,
  demean_reg <span class="op">=</span> <span class="va">reg</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">reg</span>, <span class="va">id</span><span class="op">)</span>,
  demean_asq_cl <span class="op">=</span> <span class="va">asq_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">asq_cl</span>, <span class="va">id</span><span class="op">)</span>,
  demean_appearance_cl <span class="op">=</span> <span class="va">appearance_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">appearance_cl</span>, <span class="va">id</span><span class="op">)</span>,
  demean_provider_second <span class="op">=</span> <span class="va">provider_second</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">provider_second</span>, <span class="va">id</span><span class="op">)</span>,
  demean_asian_cl <span class="op">=</span> <span class="va">asian_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">asian_cl</span>, <span class="va">id</span><span class="op">)</span>,
  demean_black_cl <span class="op">=</span> <span class="va">black_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">black_cl</span>, <span class="va">id</span><span class="op">)</span>,
  demean_hispanic_cl <span class="op">=</span> <span class="va">hispanic_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">hispanic_cl</span>, <span class="va">id</span><span class="op">)</span>,
  demean_othrace_cl <span class="op">=</span> <span class="va">othrace_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">lnw</span>, <span class="va">id</span><span class="op">)</span>,
  demean_hot <span class="op">=</span> <span class="va">hot</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">hot</span>, <span class="va">id</span><span class="op">)</span>,
  demean_massage_cl <span class="op">=</span> <span class="va">massage_cl</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html">ave</a></span><span class="op">(</span><span class="va">massage_cl</span>, <span class="va">id</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co">#-- POLS</span>
<span class="va">ols</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">lnw</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">asq</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">hispanic</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">other</span> <span class="op">+</span> <span class="va">asian</span> <span class="op">+</span> <span class="va">schooling</span> <span class="op">+</span> <span class="va">cohab</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">divorced</span> <span class="op">+</span> <span class="va">separated</span> <span class="op">+</span> 
           <span class="va">age_cl</span> <span class="op">+</span> <span class="va">unsafe</span> <span class="op">+</span> <span class="va">llength</span> <span class="op">+</span> <span class="va">reg</span> <span class="op">+</span> <span class="va">asq_cl</span> <span class="op">+</span> <span class="va">appearance_cl</span> <span class="op">+</span> <span class="va">provider_second</span> <span class="op">+</span> <span class="va">asian_cl</span> <span class="op">+</span> <span class="va">black_cl</span> <span class="op">+</span> <span class="va">hispanic_cl</span> <span class="op">+</span> 
           <span class="va">othrace_cl</span> <span class="op">+</span> <span class="va">hot</span> <span class="op">+</span> <span class="va">massage_cl</span>, data <span class="op">=</span> <span class="va">balanced_sasp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ols</span><span class="op">)</span>


<span class="co">#-- FE</span>
<span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="st">"lnw ~ age + asq + bmi + hispanic + black + other + asian + schooling + 
                      cohab + married + divorced + separated + 
                      age_cl + unsafe + llength + reg + asq_cl + appearance_cl + 
                      provider_second + asian_cl + black_cl + hispanic_cl + 
                      othrace_cl + hot + massage_cl"</span><span class="op">)</span>

<span class="va">model_fe</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>,
                  data <span class="op">=</span> <span class="va">balanced_sasp</span>, 
                  fixed_effect <span class="op">=</span> <span class="op">~</span><span class="va">id</span>, 
                  se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_fe</span><span class="op">)</span>

<span class="co">#-- Demean OLS</span>
<span class="va">dm_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="st">"demean_lnw ~ demean_age + demean_asq + demean_bmi + 
                demean_hispanic + demean_black + demean_other +
                demean_asian + demean_schooling + demean_cohab + 
                demean_married + demean_divorced + demean_separated +
                demean_age_cl + demean_unsafe + demean_llength + demean_reg + 
                demean_asq_cl + demean_appearance_cl + 
                demean_provider_second + demean_asian_cl + demean_black_cl + 
                demean_hispanic_cl + demean_othrace_cl +
                demean_hot + demean_massage_cl"</span><span class="op">)</span>

<span class="va">ols_demean</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">dm_formula</span>, 
                data <span class="op">=</span> <span class="va">balanced_sasp</span>, clusters <span class="op">=</span> <span class="va">id</span>,
                se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ols_demean</span><span class="op">)</span></code></pre></div>
<p>A few comments about this analysis. Some of the respondents left certain questions blank, most likely due to concerns about anonymity and privacy. So I dropped anyone who had missing values for the sake of this exercise. This leaves us with a balanced panel. I have organized the output into Table <a href="ch7.html#tab:sasp">8.3</a>. There’s a lot of interesting information in these three columns, some of which may surprise you if only for the novelty of the regressions. So let’s talk about the statistically significant ones. The pooled OLS regressions, recall, do not control for unobserved heterogeneity, because by definition those are unobservable. So these are potentially biased by the unobserved heterogeneity, which is a kind of selection bias, but we will discuss them anyhow.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:sasp">Table 8.3: </span> POLS, FE and Demeaned OLS Estimates of the Determinants of Log Hourly Price for a Panel of Sex Workers</caption>
<thead><tr class="header">
<th align="left"><strong>Depvar:</strong></th>
<th align="center"><strong>POLS</strong></th>
<th align="center"><strong>FE</strong></th>
<th align="center"><strong>Demeaned OLS</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Unprotected sex with client of any kind</td>
<td align="center">0.013</td>
<td align="center">0.051<span class="math inline">\(^{*}\)</span>
</td>
<td align="center">0.051<span class="math inline">\(^{*}\)</span>
</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.028)</td>
<td align="center">(0.028)</td>
<td align="center">(0.026)</td>
</tr>
<tr class="odd">
<td align="left">Ln(Length)</td>
<td align="center"><span class="math inline">\(-0.308^{***}\)</span></td>
<td align="center"><span class="math inline">\(-0.435^{***}\)</span></td>
<td align="center"><span class="math inline">\(-0.435^{***}\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.028)</td>
<td align="center">(0.024)</td>
<td align="center">(0.019)</td>
</tr>
<tr class="odd">
<td align="left">Client was a Regular</td>
<td align="center">
<span class="math inline">\(-0.047\)</span><span class="math inline">\(^{*}\)</span>
</td>
<td align="center"><span class="math inline">\(-0.037^{**}\)</span></td>
<td align="center"><span class="math inline">\(-0.037^{**}\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.028)</td>
<td align="center">(0.019)</td>
<td align="center">(0.017)</td>
</tr>
<tr class="odd">
<td align="left">Age of Client</td>
<td align="center"><span class="math inline">\(-0.001\)</span></td>
<td align="center">0.002</td>
<td align="center">0.002</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.009)</td>
<td align="center">(0.007)</td>
<td align="center">(0.006)</td>
</tr>
<tr class="odd">
<td align="left">Age of Client Squared</td>
<td align="center">0.000</td>
<td align="center"><span class="math inline">\(-0.000\)</span></td>
<td align="center"><span class="math inline">\(-0.000\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.000)</td>
<td align="center">(0.000)</td>
<td align="center">(0.000)</td>
</tr>
<tr class="odd">
<td align="left">Client Attractiveness (Scale of 1 to 10)</td>
<td align="center">0.020<span class="math inline">\(^{***}\)</span>
</td>
<td align="center">0.006</td>
<td align="center">0.006</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.007)</td>
<td align="center">(0.006)</td>
<td align="center">(0.005)</td>
</tr>
<tr class="odd">
<td align="left">Second Provider Involved</td>
<td align="center">0.055</td>
<td align="center">0.113<span class="math inline">\(^{*}\)</span>
</td>
<td align="center">0.113<span class="math inline">\(^{*}\)</span>
</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.067)</td>
<td align="center">(0.060)</td>
<td align="center">(0.048)</td>
</tr>
<tr class="odd">
<td align="left">Asian Client</td>
<td align="center"><span class="math inline">\(-0.014\)</span></td>
<td align="center"><span class="math inline">\(-0.010\)</span></td>
<td align="center"><span class="math inline">\(-0.010\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.049)</td>
<td align="center">(0.034)</td>
<td align="center">(0.030)</td>
</tr>
<tr class="odd">
<td align="left">Black Client</td>
<td align="center">0.092</td>
<td align="center">0.027</td>
<td align="center">0.027</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.073)</td>
<td align="center">(0.042)</td>
<td align="center">(0.037)</td>
</tr>
<tr class="odd">
<td align="left">Hispanic Client</td>
<td align="center">0.052</td>
<td align="center"><span class="math inline">\(-0.062\)</span></td>
<td align="center"><span class="math inline">\(-0.062\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.080)</td>
<td align="center">(0.052)</td>
<td align="center">(0.045)</td>
</tr>
<tr class="odd">
<td align="left">Other Ethnicity Client</td>
<td align="center">0.156<span class="math inline">\(^{**}\)</span>
</td>
<td align="center">0.142<span class="math inline">\(^{***}\)</span>
</td>
<td align="center">0.142<span class="math inline">\(^{***}\)</span>
</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.068)</td>
<td align="center">(0.049)</td>
<td align="center">(0.045)</td>
</tr>
<tr class="odd">
<td align="left">Met Client in Hotel</td>
<td align="center">0.133<span class="math inline">\(^{***}\)</span>
</td>
<td align="center">0.052<span class="math inline">\(^{*}\)</span>
</td>
<td align="center">0.052<span class="math inline">\(^{*}\)</span>
</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.029)</td>
<td align="center">(0.027)</td>
<td align="center">(0.024)</td>
</tr>
<tr class="odd">
<td align="left">Gave Client a Massage</td>
<td align="center"><span class="math inline">\(-0.134^{***}\)</span></td>
<td align="center"><span class="math inline">\(-0.001\)</span></td>
<td align="center"><span class="math inline">\(-0.001\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.029)</td>
<td align="center">(0.028)</td>
<td align="center">(0.024)</td>
</tr>
<tr class="odd">
<td align="left">Age of provider</td>
<td align="center">0.003</td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.012)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Age of provider squared</td>
<td align="center"><span class="math inline">\(-0.000\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.000)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Body Mass Index</td>
<td align="center"><span class="math inline">\(-0.022^{***}\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.002)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Hispanic</td>
<td align="center"><span class="math inline">\(-0.226^{***}\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.082)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Black</td>
<td align="center">0.028</td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.064)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="center"><span class="math inline">\(-0.112\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.077)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Asian</td>
<td align="center">0.086</td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.158)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Imputed Years of Schooling</td>
<td align="center">0.020<span class="math inline">\(^{**}\)</span>
</td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.010)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Cohabitating (living with a partner) but unmarried</td>
<td align="center"><span class="math inline">\(-0.054\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.036)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Currently married and living with your spouse</td>
<td align="center">0.005</td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.043)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Divorced and not remarried</td>
<td align="center"><span class="math inline">\(-0.021\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.038)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">Married but not currently living with your spouse</td>
<td align="center"><span class="math inline">\(-0.056\)</span></td>
<td align="center">0.000</td>
<td align="center">0.000</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center">(0.059)</td>
<td align="center">(.)</td>
<td align="center">(.)</td>
</tr>
<tr class="odd">
<td align="left">N</td>
<td align="center">1,028</td>
<td align="center">1,028</td>
<td align="center">1,028</td>
</tr>
<tr class="even">
<td align="left">Mean of dependent variable</td>
<td align="center">5.57</td>
<td align="center">5.57</td>
<td align="center">0.00</td>
</tr>
</tbody>
</table></div>
<p class="footnote">
Heteroskedastic robust standard errors in parenthesis clustered at the provider level. <span class="math inline">\(^{*}\)</span><span class="math inline">\(p&lt;0.10\)</span>, <span class="math inline">\(^{**}\)</span><span class="math inline">\(p&lt;0.05\)</span>, <span class="math inline">\(^{**}\)</span><span class="math inline">\(^{*}\)</span><span class="math inline">\(p&lt;0.01\)</span>
</p>
<p>First, a simple scan of the second and third column will show that the fixed effects regression which included (not shown) dummies for the individual herself is equivalent to a regression on the demeaned data. This should help persuade you that the fixed effects and the demeaned (within) estimators are yielding the same coefficients.</p>
<p>But second, let’s dig into the results. One of the first things we observe is that in the pooled OLS model, there is not a compensating wage differential detectable on having unprotected sex with a client.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;There were three kinds of sexual encounter—vaginal receptive sex, anal receptive sex, and fellatio. Unprotected sex is coded as any sex act without a condom.&lt;/p&gt;"><sup>138</sup></a> But, notice that in the fixed effects model, unprotected sex has a premium. This is consistent with <span class="citation">Rosen (<a href="references.html#ref-Rosen1986" role="doc-biblioref">1986</a>)</span> who posited the existence of risk premia, as well as <span class="citation">Gertler, Shah, and Bertozzi (<a href="references.html#ref-Gertler2005" role="doc-biblioref">2005</a>)</span> who found risk premia for sex workers using panel data. <span class="citation">Gertler, Shah, and Bertozzi (<a href="references.html#ref-Gertler2005" role="doc-biblioref">2005</a>)</span>, though, find a much larger premia of over 20% for unprotected sex, whereas I am finding only a mere 5%. This could be because a large number of the unprotected instances are fellatio, which carries a much lower risk of infection than unprotected receptive intercourse. Nevertheless, it is interesting that unprotected sex, under the assumption of strict exogeneity, appears to cause wages to rise by approximately 5%, which is statistically significant at the 10% level. Given an hourly wage of $262, this amounts to a mere 13 additional dollars per hour. The lack of a finding in the pooled OLS model seems to suggest that the unobserved heterogeneity was masking the effect.</p>
<p>Next we look at the session length. Note that I have already adjusted the price the client paid for the length of the session so that the outcome is a log wage, as opposed to a log price. As this is a log-log regression, we can interpret the coefficient on log length as an elasticity. When we use fixed effects, the elasticity increases from <span class="math inline">\(-0.308\)</span> to <span class="math inline">\(-0.435\)</span>. The significance of this result, in economic terms, though, is that there appear to be “volume discounts” in sex work. That is, longer sessions are more expensive, but at a decreasing rate. Another interesting result is whether the client was a “regular,” which meant that she had seen him before in another session. In our pooled OLS model, regulars paid 4.7% less, but this shrinks slightly in our fixed effects model to 3.7% reductions. Economically, this could be lower because new clients pose risks that repeat customers do not pose. Thus, if we expect prices to move closer to marginal cost, the disappearance of some of the risk from the repeated session should lower price, which it appears to do.</p>
<p>Another factor related to price is the attractiveness of the client. Interestingly, this does not go in the direction we may have expected. One might expect that the more attractive the client, the <em>less</em> he pays. But in fact it is the opposite. Given other research that finds beautiful people earn more money <span class="citation">(Hamermesh and Biddle <a href="references.html#ref-Hamermesh1994" role="doc-biblioref">1994</a>)</span>, it’s possible that sex workers are price-discriminating. That is, when they see a handsome client, they deduce he earns more, and therefore charge him more. This result does not hold up when including fixed effects, though, suggesting that it is due to unobserved heterogeneity, at least in part.</p>
<p>Similar to unprotected sex, a second provider present has a positive effect on price, which is only detectable in the fixed effects model. Controlling for unobserved heterogeneity, the presence of a second provider increases prices by 11.3%. We also see that she discriminates against clients of “other” ethnicities, who pay 14.2% more than White clients. There’s a premium associated with meeting in a hotel which is considerably smaller when controlling for provider fixed effects by almost a third. This positive effect, even in the fixed effects model, may simply represent the higher costs associated with meeting in a hotel room. The other coefficients are not statistically significant.</p>
<p>Many of the time-invariant results are also interesting, though. For instance, perhaps not surprisingly, women with higher BMI earn less. Hispanics earn less than White sex workers. And women with more schooling earn more, something which is explored in greater detail in <span class="citation">Cunningham and Kendall (<a href="references.html#ref-Cunningham2016b" role="doc-biblioref">2016</a>)</span>.</p>
</div>
<div id="conclusion-6" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-6"><i class="fas fa-link"></i></a>
</h2>
<p>In conclusion, we have been exploring the usefulness of panel data for estimating causal effects. We noted that the fixed effects (within) estimator is a very useful method for addressing a very specific form of endogeneity, with some caveats. First, it will eliminate any and all unobserved and observed time-invariant covariates correlated with the treatment variable. So long as the treatment and the outcome varies over time, and there is strict exogeneity, then the fixed effects (within) estimator will identify the causal effect of the treatment on some outcome.</p>
<p>But this came with certain qualifications. For one, the method couldn’t handle <em>time-variant</em> unobserved heterogeneity. It’s thus the burden of the researcher to determine which type of unobserved heterogeneity problem they face, but if they face the latter, then the panel methods reviewed here are not unbiased and consistent. Second, when there exists strong reverse causality pathways, then panel methods are biased. Thus, we cannot solve the problem of simultaneity, such as what Wright faced when estimating the price elasticity of demand, using the fixed effects (within) estimator. Most likely, we are going to have to move into a different framework when facing that kind of problem.</p>
<p>Still, many problems in the social sciences may credibly be caused by a time-invariant unobserved heterogeneity problem, in which case the fixed effects (within) panel estimator is useful and appropriate.</p>
<div class="cover-box">
<div class="row">
    <div class="col-xs-8 col-md-4 cover-img">
        <a href="https://www.amazon.com/dp/0300251688"><img src="images/cover.jpg" alt="Buy Today!"></a>
    </div>
    
    <div class="col-xs-12 col-md-8 cover-text-box">
            <h2> 
                Causal Inference: 
                <br><span style="font-style: italic; font-weight:bold; font-size: 20px;">The Mixtape.</span>
            </h2> 
            
        <div class="cover-text">
            <p>Buy the print version today:</p>
            
            <div class="chips">
                <a href="https://www.amazon.com/dp/0300251688" class="app-chip"> 
                    <i class="fab fa-amazon" aria-hidden="true"></i> Buy from Amazon 
                </a>
    
                <a href="https://yalebooks.yale.edu/book/9780300251685/causal-inference" class="app-chip"> 
                    <i class="fas fa-book" aria-hidden="true"></i> Buy from Yale Press 
                </a>
            </div>
        </div>
    </div>
</div>
</div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="ch6.html"><span class="header-section-number">7</span> Instrumental Variables</a></div>
<div class="next"><a href="ch8.html"><span class="header-section-number">9</span> Difference-in-Differences</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ch7"><span class="header-section-number">8</span> Panel Data</a></li>
<li><a class="nav-link" href="#dag-example"><span class="header-section-number">8.1</span> DAG Example</a></li>
<li>
<a class="nav-link" href="#estimation"><span class="header-section-number">8.2</span> Estimation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pooled-ols"><span class="header-section-number">8.2.1</span> Pooled OLS</a></li>
<li><a class="nav-link" href="#fixed-effects-within-estimator"><span class="header-section-number">8.2.2</span> Fixed effects (within Estimator)</a></li>
<li><a class="nav-link" href="#identifying-assumptions-1"><span class="header-section-number">8.2.3</span> Identifying Assumptions</a></li>
<li><a class="nav-link" href="#caveat-1-fixed-effects-cannot-solve-reverse-causality"><span class="header-section-number">8.2.4</span> Caveat #1: Fixed effects cannot solve reverse causality</a></li>
<li><a class="nav-link" href="#caveat-2-fixed-effects-cannot-address-time-variant-unobserved-heterogeneity"><span class="header-section-number">8.2.5</span> Caveat #2: Fixed effects cannot address time-variant unobserved heterogeneity</a></li>
<li><a class="nav-link" href="#returns-to-marriage-and-unobserved-heterogeneity"><span class="header-section-number">8.2.6</span> Returns to marriage and unobserved heterogeneity</a></li>
</ul>
</li>
<li><a class="nav-link" href="#data-exercise-survey-of-adult-service-providers"><span class="header-section-number">8.3</span> Data Exercise: Survey of Adult Service Providers</a></li>
<li><a class="nav-link" href="#conclusion-6"><span class="header-section-number">8.4</span> Conclusion</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/scunning1975/mixtape/blob/master/07-Panel_Data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/scunning1975/mixtape/edit/master/07-Panel_Data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><span style="font-weight:bold">Causal Inference</span></strong>: <i>The Mixtape</i>" was written by Scott Cunningham. It was last built on 2020-12-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
