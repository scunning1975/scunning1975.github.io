<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 Synthetic Control | Causal Inference</title>
<meta name="author" content="Scott Cunningham">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><style>
    @import url('https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,700;1,300&display=swap');
    </style>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/toc.css">
<link rel="stylesheet" href="css/causal_inference_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="&lt;i&gt;The Mixtape&lt;/i&gt;"><span style="font-weight:bold">Causal Inference</span></a>:
        <small class="text-muted"><i>The Mixtape</i></small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="ch1.html"><span class="header-section-number">2</span> Probability and Regression Review</a></li>
<li><a class="" href="ch2.html"><span class="header-section-number">3</span> Directed Acyclic Graphs</a></li>
<li><a class="" href="ch3.html"><span class="header-section-number">4</span> Potential Outcomes Causal Model</a></li>
<li><a class="" href="ch4.html"><span class="header-section-number">5</span> Matching and Subclassification</a></li>
<li><a class="" href="ch5.html"><span class="header-section-number">6</span> Regression Discontinuity</a></li>
<li><a class="" href="ch6.html"><span class="header-section-number">7</span> Instrumental Variables</a></li>
<li><a class="" href="ch7.html"><span class="header-section-number">8</span> Panel Data</a></li>
<li><a class="" href="ch8.html"><span class="header-section-number">9</span> Difference-in-Differences</a></li>
<li><a class="active" href="ch9.html"><span class="header-section-number">10</span> Synthetic Control</a></li>
<li><a class="" href="ch10.html"><span class="header-section-number">11</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/scunning1975/mixtape">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ch9" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Synthetic Control<a class="anchor" aria-label="anchor" href="#ch9"><i class="fas fa-link"></i></a>
</h1>
<div class="cover-box">
<div class="row">
    <div class="col-xs-8 col-md-4 cover-img">
        <a href="https://www.amazon.com/dp/0300251688"><img src="../images/cover.jpg" alt="Buy Today!"></a>
    </div>
    
    <div class="col-xs-12 col-md-8 cover-text-box">
            <h2> 
                Causal Inference: 
                <br><span style="font-style: italic; font-weight:bold; font-size: 20px;">The Mixtape.</span>
            </h2> 
            
        <div class="cover-text">
            <p>Buy the print version today:</p>
            
            <div class="chips">
                <a href="https://www.amazon.com/dp/0300251688" class="app-chip"> 
                    <i class="fab fa-amazon" aria-hidden="true"></i> Buy from Amazon 
                </a>
    
                <a href="https://yalebooks.yale.edu/book/9780300251685/causal-inference" class="app-chip"> 
                    <i class="fas fa-book" aria-hidden="true"></i> Buy from Yale Press 
                </a>
            </div>
        </div>
    </div>
</div>
</div>
<div id="introducing-the-comparative-case-study" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Introducing the Comparative Case Study<a class="anchor" aria-label="anchor" href="#introducing-the-comparative-case-study"><i class="fas fa-link"></i></a>
</h2>
<p>The first appearance of the synthetic control estimator was a 2003 article where it was used to estimate the impact of terrorism on economic activity <span class="citation">(Abadie and Gardeazabal <a href="references.html#ref-Abadie2003" role="doc-biblioref">2003</a>)</span>. Since that publication, it has become very popular—particularly after the release of an R and Stata package coinciding with <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span>. A Google Scholar search for the words “synthetic control” and “Abadie” yielded over 3,500 hits at the time of writing. The estimator has been so influential that <span class="citation">Athey and Imbens (<a href="references.html#ref-Athey2017c" role="doc-biblioref">2017</a><a href="references.html#ref-Athey2017c" role="doc-biblioref">a</a>)</span> said it was “arguably the most important innovation in the policy evaluation literature in the last 15 years” (p.3).</p>
<p>To understand the reasons you might use synthetic control, let’s back up to the broader idea of the comparative case study. In qualitative case studies, such as Alexis de Tocqueville’s classic <em>Democracy in America</em>, the goal is to reason inductively about the causal effect of events or characteristics of a single unit on some outcome using logic and historical analysis. But it may not give a very satisfactory answer to these causal questions because sometimes qualitative comparative case studies lack an explicit counterfactual. As such, we are usually left with description and speculation about the causal pathways connecting various events to outcomes.</p>
<p>Quantitative comparative case studies are more explicitly causal designs. They usually are natural experiments and are applied to only a single unit, such as a single school, firm, state, or country. These kinds of quantitative comparative case studies compare the evolution of an aggregate outcome with either some single other outcome, or as is more often the case, a chosen set of similar units that serve as a control group.</p>
<p>As <span class="citation">Athey and Imbens (<a href="references.html#ref-Athey2017c" role="doc-biblioref">2017</a><a href="references.html#ref-Athey2017c" role="doc-biblioref">a</a>)</span> point out, one of the most important contributions to quantitative comparative case studies is the synthetic control model. The synthetic control model was developed in <span class="citation">Abadie and Gardeazabal (<a href="references.html#ref-Abadie2003" role="doc-biblioref">2003</a>)</span> in a study of terrorism’s effect on aggregate income, which was then elaborated on in a more exhaustive treatment <span class="citation">(Abadie, Diamond, and Hainmueller <a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span>. Synthetic controls models optimally choose a set of weights which when applied to a group of corresponding units produce an optimally estimated counterfactual to the unit that received the treatment. This counterfactual, called the “synthetic unit,” serves to outline what would have happened to the aggregate treated unit had the treatment never occurred. It is a powerful, yet surprisingly simple, generalization of the difference-in-differences strategy. We will discuss it with a motivating example—the paper on the famous Mariel boatlift by <span class="citation">Card (<a href="references.html#ref-Card1990" role="doc-biblioref">1990</a>)</span>.</p>
<div id="cuba-miami-and-the-mariel-boatlift" class="section level3" number="10.1.1">
<h3>
<span class="header-section-number">10.1.1</span> Cuba, Miami, and the Mariel Boatlift<a class="anchor" aria-label="anchor" href="#cuba-miami-and-the-mariel-boatlift"><i class="fas fa-link"></i></a>
</h3>
<p>Labor economists have debated the effect of immigration on local labor-market conditions for many years <span class="citation">(Card and Peri <a href="references.html#ref-Card2016" role="doc-biblioref">2016</a>)</span>. Do inflows of immigrants depress wages and the employment of natives in local labor-markets? For <span class="citation">Card (<a href="references.html#ref-Card1990" role="doc-biblioref">1990</a>)</span>, this was an empirical question, and he used a natural experiment to evaluate it.</p>
<p>In 1980, Fidel Castro announced that anyone wishing to leave Cuba could do so. With Castro’s support, Cuban Americans helped arrange the Mariel boatlift, a mass exodus from Cuba’s Mariel Harbor to the United States (primarily Miami) between April and October 1980. Approximately 125,000 Cubans emigrated to Florida over six months. The emigration stopped only because Cuba and the US mutually agreed to end it. The event increased the Miami labor force by 7%, largely by depositing a record number of low-skilled workers into a relatively small geographic area.</p>
<p>Card saw this as an ideal natural experiment. It was arguably an exogenous shift in the labor-supply curve, which would allow him to determine if wages fell and employment increased, consistent with a simple competitive labor-market model. He used individual-level data on unemployment from the Current Population Survey for Miami and chose four comparison cities (Atlanta, Los Angeles, Houston, and Tampa–St. Petersburg). The choice of these four cities is delegated to a footnote in which Card argues that they were similar based on demographics and economic conditions. Card estimated a simple DD model and found, surprisingly, no effect on wages or native unemployment. He argued that Miami’s labor-market was capable of absorbing the surge in labor supply because of similar surges two decades earlier.</p>
<p>The paper was very controversial, probably not so much because he attempted to answer empirically an important question in labor economics using a natural experiment, but rather because the result violated conventional wisdom. It would not be the last word on the subject, and I don’t take a stand on this question; rather, I introduce it to highlight a few characteristics of the study. Notably, a recent study replicated Card’s paper using synthetic control and found similar results <span class="citation">(Peri and Yasenov <a href="references.html#ref-Peri2018" role="doc-biblioref">2018</a>)</span>.</p>
<p>Card’s study was a comparative case study that had strengths and weaknesses. The policy intervention occurred at an aggregate level, for which aggregate data was available. But the problems with the study were that the selection of the control group was <em>ad hoc</em> and subjective. Second, the standard errors reflect sampling variance as opposed to uncertainty about the ability of the control group to reproduce the counterfactual of interest. <span class="citation">Abadie and Gardeazabal (<a href="references.html#ref-Abadie2003" role="doc-biblioref">2003</a>)</span> and <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> introduced the synthetic control estimator as a way of addressing both issues simultaneously.</p>
<p><span class="citation">Abadie and Gardeazabal (<a href="references.html#ref-Abadie2003" role="doc-biblioref">2003</a>)</span> method uses a weighted average of units in the donor pool to model the counterfactual. The method is based on the observation that, when the units of analysis are a few aggregate units, a combination of comparison units (the “synthetic control”) often does a better job of reproducing characteristics of a treated unit than using a single comparison unit alone. The comparison unit, therefore, in this method is selected to be the weighted average of all comparison units that best resemble the characteristics of the treated unit(s) in the pre-treatment period.</p>
<p><span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> argue that this method has many distinct advantages over regression-based methods. For one, the method precludes extrapolation. It uses instead interpolation, because the estimated causal effect is always based on a comparison between some outcome in a given year and a counterfactual in the same year. That is, it uses as its counterfactual a convex hull of control group units, and thus the counterfactual is based on where data actually is, as opposed to extrapolating beyond the support of the data, which can occur in extreme situations with regression <span class="citation">(King and Zeng <a href="references.html#ref-King2006" role="doc-biblioref">2006</a>)</span>.</p>
<p>A second advantage has to do with processing of the data. The construction of the counterfactual does not require access to the post-treatment outcomes during the design phase of the study, unlike regression. The advantage here is that it helps the researcher avoid “peeking” at the results while specifying the model. Care and honesty must still be used, as it’s just as easy to look at the outcomes during the design phase as it is to not, but the point is that it is hypothetically possible to focus just on design, and not estimation, with this method <span class="citation">(Rubin <a href="references.html#ref-Rubin2007" role="doc-biblioref">2007</a>, <a href="references.html#ref-Rubin2008" role="doc-biblioref">2008</a>)</span>.</p>
<p>Another advantage, which is oftentimes a reason people will object to a study, is that the weights that are chosen make explicit what each unit is contributing to the counterfactual. Now this is in many ways a strict advantage, except when it comes to defending those weights in a seminar. Because someone can see that Idaho is contributing 0.3 to your modeling of Florida, they are now able to argue that it’s absurd to think Idaho is anything like Florida. But contrast this with regression, which also weights the data, but does so blindly. The only reason no one objects to what regression produces as a weight is that they <em>cannot see the weights</em>. They are implicit rather than explicit. So I see this explicit production of weights as a distinct advantage because it makes synthetic control more transparent than regression-based designs (even if will likely require fights with the audience and reader that you wouldn’t have had otherwise).</p>
<p>A fourth advantage, which I think is often unappreciated, is that it bridges a gap between qualitative and quantitative types. Qualitative researchers are often the very ones focused on describing a single unit, such as a country or a prison <span class="citation">(Perkinson <a href="references.html#ref-Perkinson2010" role="doc-biblioref">2010</a>)</span>, in great detail. They are usually the experts on the histories surrounding those institutions. They are usually the ones doing comparative case studies in the first place. Synthetic control places a valuable tool into their hands which enables them to choose counterfactuals—a process that in principle can improve their work insofar as they are interested in evaluating some particular intervention.</p>
</div>
<div id="picking-synthetic-controls" class="section level3" number="10.1.2">
<h3>
<span class="header-section-number">10.1.2</span> Picking synthetic controls<a class="anchor" aria-label="anchor" href="#picking-synthetic-controls"><i class="fas fa-link"></i></a>
</h3>
<p><span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> argue that synthetic control removes subjective researcher bias, but it turns out it is somewhat more complicated. The frontier of this method has grown considerably in recent years, along different margins, one of which is via the model-fitting exercise itself. Some new ways of trying to choose more principled models have appeared, particularly when efforts to fit the data with the synthetic control in the pre-treatment period are imperfect. <span class="citation">Ferman and Pinto (<a href="references.html#ref-Ferman2019" role="doc-biblioref">2019</a>)</span> and <span class="citation">Powell (<a href="references.html#ref-Powell2017" role="doc-biblioref">2017</a>)</span>, for instance, propose alternative solutions to this problem. <span class="citation">Ferman and Pinto (<a href="references.html#ref-Ferman2019" role="doc-biblioref">2019</a>)</span> examine the properties of using de-trended data. They find that it can have advantages, and even dominate DD, in terms of bias and variance.</p>
<p>When there are transitory shocks, which is common in practice, the fit deteriorates, thus introducing bias. <span class="citation">Powell (<a href="references.html#ref-Powell2017" role="doc-biblioref">2017</a>)</span> provides a parametric solution, however, which cleverly exploits information in the procedure that may help reconstruct the treatment unit. Assume that Georgia receives some treatment but for whatever reason the convex hull assumption does not hold in the data (i.e., Georgia is unusual). <span class="citation">Powell (<a href="references.html#ref-Powell2017" role="doc-biblioref">2017</a>)</span> shows that if Georgia appears in the synthetic control for some other state, then it is possible to recover the treatment effect through a kind of backdoor procedure. Using the appearance of Georgia as a control in all the placebos can then be used to reconstruct the counterfactual.</p>
<p>But still there remain questions regarding the selection of the covariates that will be used for any matching. Through repeated iterations and changes to the matching formula, a person can potentially reintroduce bias through the endogenous selection of covariates used in a specification search. While the weights are optimally chosen to minimize some distance function, through the choice of the covariates themselves, the researcher can in principle select different weights. She just doesn’t have a lot of control over it, because ultimately the weights are optimal for a given set of covariates, but selecting models that suit one’s priors is still possible.</p>
<p><span class="citation">Ferman, Pinto, and Possebom (<a href="references.html#ref-Ferman2020" role="doc-biblioref">2020</a>)</span> addressed this gap in the literature by providing guidance on principled covariate selection. They consider a variety of commonly used synthetic control specifications (e.g., all pre-treatment outcome values, the first three quarters of the pre-treatment outcome values). They then run the randomization inference test to calculate empirical <span class="math inline">\(p\)</span>-values. They find that the probability of falsely rejecting the null in at least one specification for a 5% significance test can be as high as 14% when there are pre-treatment periods. The possibilities for specification searching remain high even when the number of pre-treatment periods is large, too. They consider a sample with four hundred pre-treatment periods and still find a false-positive probability of around 13% that at least one specification was significant at the 5% level. Thus, even with a large number of pre-treatment periods, it is theoretically possible to “hack” the analysis in order to find statistical significance that suits one’s priors.</p>
<p>Given the broad discretion available to a researcher to search over countless specifications using covariates and pretreatment combinations, one might conclude that fewer time periods are better if for no other reason than that this limits the ability to conduct an endogenous specification search. Using Monte Carlo simulations, though, they find that models which use more pre-treatment outcome lags as predictors—consistent with statements made by <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> originally—do a better job controlling for unobserved confounders, whereas those which limit the number of pre-treatment outcome lags substantially misallocate more weights and should not be considered in synthetic control applications.</p>
<p>Thus, one of the main takeaways of <span class="citation">Ferman, Pinto, and Possebom (<a href="references.html#ref-Ferman2020" role="doc-biblioref">2020</a>)</span> is that, despite the hope that synthetic control would remove subjective researcher bias by creating weights based on a data-driven optimization algorithm, this may be somewhat overstated in practice. Whereas it remains true that the weights are optimal in that they uniquely minimize the distance function, the point of <span class="citation">Ferman, Pinto, and Possebom (<a href="references.html#ref-Ferman2020" role="doc-biblioref">2020</a>)</span> is to note that the distance function is still, at the end of the day, <em>endogenously chosen by the researcher</em>.</p>
<p>So, given this risk of presenting results that may be cherry picked, what should we do? <span class="citation">Ferman, Pinto, and Possebom (<a href="references.html#ref-Ferman2020" role="doc-biblioref">2020</a>)</span> suggest presenting multiple results under a variety of commonly specified specifications. If it is regularly robust, the reader may have sufficient information to check this, as opposed to only seeing one specification which may be the cherry-picked result.</p>
</div>
<div id="formalization" class="section level3" number="10.1.3">
<h3>
<span class="header-section-number">10.1.3</span> Formalization<a class="anchor" aria-label="anchor" href="#formalization"><i class="fas fa-link"></i></a>
</h3>
<p>Let <span class="math inline">\(Y_{jt}\)</span> be the outcome of interest for unit <span class="math inline">\(j\)</span> of <span class="math inline">\(J+1\)</span> aggregate units at time <span class="math inline">\(t\)</span>, and treatment group be <span class="math inline">\(j=1.\)</span> The synthetic control estimator models the effect of the intervention at time <span class="math inline">\(T_0\)</span> on the treatment group using a linear combination of optimally chosen units as a synthetic control. For the post-intervention period, the synthetic control estimator measures the causal effect as <span class="math inline">\(Y_{1t}- \sum_{j=2}^{J+1}w_j^*Y_{jt}\)</span> where <span class="math inline">\(w_j^*\)</span> is a vector of optimally chosen weights.</p>
<p>Matching variables, <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_0,\)</span> are chosen as predictors of post-intervention outcomes and must be unaffected by the intervention. The weights are chosen so as to minimize the norm, <span class="math inline">\(||X_1 - X_0W||\)</span> subject to weight constraints. There are two weight constraints. First, let <span class="math inline">\(W=(w_2, \dots, w_{J+1})'\)</span> with <span class="math inline">\(w_j \geq 0\)</span> for <span class="math inline">\(j=2, \dots, J+1\)</span>. Second, let <span class="math inline">\(w_2 + \dots + w_{J+1}=1\)</span>. In words, no unit receives a negative weight, but can receive a zero weight.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;See &lt;span class="citation"&gt;Doudchenko and Imbens (&lt;a href="references.html#ref-Doudchenko2016" role="doc-biblioref"&gt;2016&lt;/a&gt;)&lt;/span&gt; for work relaxing the non-negativity constraint.&lt;/p&gt;'><sup>163</sup></a> And the sum of all weights must equal one.</p>
<p>As I said, <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> consider</p>
<p><span class="math display">\[\begin{align}
||X_1 - X_0W|| = \sqrt{(X_1 - X_0W)'V(X_1 - X_0W)}
\end{align}\]</span></p>
<p>where <span class="math inline">\(V\)</span> is some <span class="math inline">\((k \times k)\)</span> symmetric and positive semidefinite matrix. Let <span class="math inline">\(X_{jm}\)</span> be the value of the <span class="math inline">\(m\)</span>th covariates for unit <span class="math inline">\(j\)</span>. Typically, <span class="math inline">\(V\)</span> is diagonal with main diagonal <span class="math inline">\(v_1, \dots, v_k\)</span>. Then the synthetic control weights minimize:
<span class="math display">\[
\sum_{m=1}^k v_m \bigg(X_{1m} - \sum_{j=2}^{J+1}w_jX_{jm} \bigg)^2
\]</span>
where <span class="math inline">\(v_m\)</span> is a weight that reflects the relative importance that we assign to the <span class="math inline">\(m\)</span>th variable when we measure the discrepancy between the treated unit and the synthetic control.</p>
<p>The choice of <span class="math inline">\(V\)</span>, as should be seen by now, is important because <span class="math inline">\(W^*\)</span> depends on one’s choice of <span class="math inline">\(V\)</span>. The synthetic control <span class="math inline">\(W^*(V)\)</span> is meant to reproduce the behavior of the outcome variable for the treated unit in the absence of the treatment. Therefore, the weights <span class="math inline">\(v_1, \dots, v_k\)</span> should reflect the predictive value of the covariates.</p>
<p><span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> suggests different choices of <span class="math inline">\(V\)</span>, but ultimately it appears from practice that most people choose a <span class="math inline">\(V\)</span> that minimizes the mean squared prediction error:
<span class="math display">\[
\sum_{t=1}^{T_0} \bigg (Y_{1t} - \sum_{j=2}^{J+1}w_j^*(V)Y_{jt}\bigg )^2
\]</span>
What about unobserved factors? Comparative case studies are complicated by unmeasured factors affecting the outcome of interest as well as heterogeneity in the effect of observed and unobserved factors. <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> note that if the number of pre-intervention periods in the data is “large,” then matching on pre-intervention outcomes can allow us to control for the heterogeneous responses to multiple unobserved factors. The intuition here is that only units that are alike on unobservables and observables would follow a similar trajectory pre-treatment.</p>
</div>
<div id="californias-proposition-99" class="section level3" number="10.1.4">
<h3>
<span class="header-section-number">10.1.4</span> California’s Proposition 99<a class="anchor" aria-label="anchor" href="#californias-proposition-99"><i class="fas fa-link"></i></a>
</h3>
<p><span class="citation">Abadie and Gardeazabal (<a href="references.html#ref-Abadie2003" role="doc-biblioref">2003</a>)</span> developed the synthetic control estimator so as to evaluate the impact that terrorism had on the Basque region in Spain. But <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> expound on the method by using a cigarette tax in California called Proposition 99. Their example uses a placebo-based method for inference, so let’s look more closely at their paper.</p>
<div class="figure">
<span id="fig:scm1"></span>
<img src="graphics/raw_figure.jpg" alt="California cigarette sales vs the rest of the country" width="100%"><p class="caption">
Figure 10.1: California cigarette sales vs the rest of the country
</p>
</div>
<p>In 1988, California passed comprehensive tobacco control legislation called Proposition 99. Proposition 99 increased cigarette taxes by $0.25 a pack, spurred clean-air ordinances throughout the state, funded anti-smoking media campaigns, earmarked tax revenues to health and anti-smoking budgets, and produced more than $100 million a year in anti-tobacco projects. Other states had similar control programs, and they were dropped from their analysis.</p>
<p>Figure <a href="ch9.html#fig:scm1">10.1</a> shows changes in cigarette sales for California and the rest of the United States annually from 1970 to 2000. As can be seen, cigarette sales fell after Proposition 99, but as they were already falling, it’s not clear if there was any effect—particularly since they were falling in the rest of the country at the same time.</p>
<p>Using their method, though, they select an optimal set of weights that when applied to the rest of the country produces the figure shown in Figure <a href="ch9.html#fig:scm2">10.2</a>. Notice that pre-treatment, this set of weights produces a nearly identical time path for California as the real California itself, but post-treatment the two series diverge. There appears at first glance to have been an effect of the program on cigarette sales.</p>
<div class="figure">
<span id="fig:scm2"></span>
<img src="graphics/synth_ca.jpg" alt="California cigarette sales vs synthetic California" width="100%"><p class="caption">
Figure 10.2: California cigarette sales vs synthetic California
</p>
</div>
<p>The variables they used for their distance minimization are listed in Table <a href="ch9.html#tab:abadie-balance">10.1</a>. Notice that this analysis produces values for the treatment group and control group that facilitate a simple investigation of balance. This is not a technical test, as there is only one value per variable per treatment category, but it’s the best we can do with this method. And it appears that the variables used for matching are similar across the two groups, particularly for the lagged values.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:abadie-balance">Table 10.1: </span> Balance table</caption>
<tbody>
<tr class="odd">
<td align="left"><strong>Variables</strong></td>
<td align="center">Real California</td>
<td align="center">Synthetic Calif.</td>
<td align="center">Avg. of 38 Control States</td>
</tr>
<tr class="even">
<td align="left">Ln(GDP per capita)</td>
<td align="center">10.08</td>
<td align="center">9.86</td>
<td align="center">9.86</td>
</tr>
<tr class="odd">
<td align="left">Percent aged 15–24</td>
<td align="center">17.40</td>
<td align="center">17.40</td>
<td align="center">17.29</td>
</tr>
<tr class="even">
<td align="left">Retail price</td>
<td align="center">89.42</td>
<td align="center">89.41</td>
<td align="center">87.27</td>
</tr>
<tr class="odd">
<td align="left">Beer consumption per capita</td>
<td align="center">24.28</td>
<td align="center">24.20</td>
<td align="center">23.75</td>
</tr>
<tr class="even">
<td align="left">Cigarette sales per capita 1988</td>
<td align="center">90.10</td>
<td align="center">91.62</td>
<td align="center">114.20</td>
</tr>
<tr class="odd">
<td align="left">Cigarette sales per capita 1980</td>
<td align="center">120.20</td>
<td align="center">120.43</td>
<td align="center">136.58</td>
</tr>
<tr class="even">
<td align="left">Cigarette sales per capita 1975</td>
<td align="center">127.10</td>
<td align="center">126.99</td>
<td align="center">132.81</td>
</tr>
</tbody>
</table></div>
<p class="footnote">
All variables except lagged cigarette sales are averaged for the 1980–1988 period. Beer consumption is averaged 1984–1988.
</p>
<p>Like RDD, synthetic control is a picture-intensive estimator. Your estimator is basically a picture of two series which, if there is a causal effect, diverge from another post-treatment, but resemble each other pre-treatment. It is common to therefore see a picture just showing the difference between the two series (Figure <a href="ch9.html#fig:scm4">10.3</a>).</p>
<div class="figure">
<span id="fig:scm4"></span>
<img src="graphics/gap_ca.jpg" alt="Gap in cigarette sales for estimation pre and post treatment" width="100%"><p class="caption">
Figure 10.3: Gap in cigarette sales for estimation pre and post treatment
</p>
</div>
<p>But so far, we have only covered estimation. How do we determine whether the observed difference between the two series is a <em>statistically significant</em> difference? After all, we only have two observations per year. Maybe the divergence between the two series is nothing more than prediction error, and any model chosen would’ve done that, even if there was no treatment effect. <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> suggest that we use an old-fashioned method to construct exact <span class="math inline">\(p\)</span>-values based on <span class="citation">Fisher (<a href="references.html#ref-Fisher1935" role="doc-biblioref">1935</a>)</span>. <span class="citation">Firpo and Possebom (<a href="references.html#ref-Firpo2018" role="doc-biblioref">2018</a>)</span> call the null hypothesis used in this test the “no treatment effect whatsoever,” which is the most common null used in the literature. Whereas they propose an alternative null for inference, I will focus on the original null proposed by <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> for this exercise. As discussed in an earlier chapter, randomization inference assigns the treatment to every untreated unit, recalculates the model’s key coefficients, and collects them into a distribution which are then used for inference. <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> recommend calculating a set of root mean squared prediction error (RMSPE) values for the pre- and post-treatment period as the test statistic used for inference.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;What we will do is simply reassign the treatment to each unit, putting California back into the donor pool each time, estimate the model for that “placebo,” and record information from each iteration.&lt;/p&gt;"><sup>164</sup></a> We proceed as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Iteratively apply the synthetic control method to each country/state in the donor pool and obtain a distribution of placebo effects.</p></li>
<li><p>Calculate the RMSPE for each placebo for the pre-treatment period:
<span class="math display">\[
RMSPE = \bigg (\dfrac{1}{T-T_0} \sum_{t=T_0+t}^T \bigg (Y_{1t} - \sum_{j=2}^{J+1} w_j^* Y_{jt} \bigg )^2 \bigg )^{\tfrac{1}{2}}
\]</span></p></li>
<li><p>Calculate the RMSPE for each placebo for the post-treatment period (similar equation but for the post-treatment period).</p></li>
<li><p>Compute the ratio of the post- to pre-treatment RMSPE.</p></li>
<li><p>Sort this ratio in descending order from greatest to highest.</p></li>
<li><p>Calculate the treatment unit’s ratio in the distribution as <span class="math inline">\(p=\dfrac{RANK}{TOTAL}\)</span>.</p></li>
</ol>
<p>In other words, what we want to know is whether California’s treatment effect is extreme, which is a relative concept compared to the donor pool’s own placebo ratios.</p>
<p>There are several different ways to represent this. The first is to overlay California with all the placebos using Stata <code>twoway</code> command, which I’ll show later. Figure <a href="ch9.html#fig:scm5">10.4</a> shows what this looks like. And I think you’ll agree, it tells a nice story. Clearly, California is in the tails of some distribution of treatment effects.</p>
<div class="figure">
<span id="fig:scm5"></span>
<img src="graphics/synth_placebo.jpg" alt="Placebo distribution using all units as donor pool" width="100%"><p class="caption">
Figure 10.4: Placebo distribution using all units as donor pool
</p>
</div>
<p><span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> recommend iteratively dropping the states whose pre-treatment RMSPE is considerably different than California’s because as you can see, they’re kind of blowing up the scale and making it hard to see what’s going on. They do this in several steps, but I’ll just skip to the last step (Figure <a href="ch9.html#fig:scm6">10.5</a>). In this, they’ve dropped any state unit from the graph whose pre-treatment RMSPE is more than two times that of California’s. This therefore limits the picture to just units whose model fit, pre-treatment, was pretty good, like California’s.</p>
<div class="figure">
<span id="fig:scm6"></span>
<img src="graphics/synth_placebo2.jpg" alt="Pre-Proposition 99 RMSPE$\geq$2 times Pre-Pop 99 RMSPE for CA" width="100%"><p class="caption">
Figure 10.5: Pre-Proposition 99 RMSPE$$2 times Pre-Pop 99 RMSPE for CA
</p>
</div>
<p>But, ultimately, inference is based on those exact <span class="math inline">\(p\)</span>-values. So the way we do this is we simply create a histogram of the ratios, and more or less mark the treatment group in the distribution so that the reader can see the exact <span class="math inline">\(p\)</span>-value associated with the model. I produce that here in Figure <a href="ch9.html#fig:scm7">10.6</a>.</p>
<p>As can be seen, California is ranked first out of thirty-eight state units.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Recall, they dropped several states who had similar legislation passed over this time period.&lt;/p&gt;"><sup>165</sup></a> This gives an exact <span class="math inline">\(p\)</span>-value of 0.026, which is less than the conventional 5% most journals want to (arbitrarily) see for statistical significance.</p>
<div class="figure">
<span id="fig:scm7"></span>
<img src="graphics/histogram.jpg" alt="Histogram of post/pre RMSPE of all units." width="100%"><p class="caption">
Figure 10.6: Histogram of post/pre RMSPE of all units.
</p>
</div>
</div>
<div id="falsifications" class="section level3" number="10.1.5">
<h3>
<span class="header-section-number">10.1.5</span> Falsifications<a class="anchor" aria-label="anchor" href="#falsifications"><i class="fas fa-link"></i></a>
</h3>
<p>In <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2015" role="doc-biblioref">2015</a>)</span>, the authors studied the effect of the reunification of Germany on gross domestic product. One of the contributions this paper makes, though, is a recommendation for testing the validity of the estimator through a falsification exercise. To illustrate this, let me review the study. The 1990 reunification of Germany brought together East Germany and West Germany, which after years of separation had developed vastly different cultures, economies, and political systems. The authors were interested in evaluating the effect that that reunification had on economic output, but as with the smoking study, they thought that the countries were simply too dissimilar from any one country to make a compelling comparison group, so they used synthetic control to create a composite comparison group based on optimally chosen countries.</p>
<p>One of the things the authors do in this study is provide some guidance as to how to check whether the model you chose is a reasonable one. The authors specifically recommend rewinding time from the date of the treatment itself and estimating their model on an earlier (placebo) date. Since placebo dates should have no effect on output, that provides some assurances that any deviations found in 1990 might be due to structural breaks caused by the reunification itself. And in fact they don’t find any effect when using 1975 as a placebo date, suggesting that their model has good in and out of sample predictive properties.</p>
<p>We include this second paper primarily to illustrate that synthetic control methods are increasingly expected to pursue numerous falsification exercises in addition to simply estimating the causal effect itself. In this sense, researchers have pushed others to hold it to the same level of scrutiny and skepticism as they have with other methodologies such as RDD and IV. Authors using synthetic control must do more than merely run the <code>synth</code> command when doing comparative case studies. They must find the exact <span class="math inline">\(p\)</span>-values through placebo-based inference, check for the quality of the pre-treatment fit, investigate the balance of the covariates used for matching, and check for the validity of the model through placebo estimation (e.g., rolling back the treatment date).</p>
</div>
</div>
<div id="prison-construction-and-black-male-incarceration" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Prison Construction and Black Male Incarceration<a class="anchor" aria-label="anchor" href="#prison-construction-and-black-male-incarceration"><i class="fas fa-link"></i></a>
</h2>
<p>The project that you’ll be replicating here is a project I have been working on with several coauthors over the last few years.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;You can find one example of an unpublished manuscript here coauthored with Sam Kang: &lt;a href="http://scunning.com/prison_booms_and_drugs_20.eps" class="uri"&gt;http://scunning.com/prison_booms_and_drugs_20.eps&lt;/a&gt;.&lt;/p&gt;'><sup>166</sup></a> Here’s the backdrop.</p>
<p>In 1980, the Texas Department of Corrections (TDC) lost a major civil action lawsuit, <em>Ruiz v. Estelle</em>; Ruiz was the prisoner who brought the case, and Estelle was the warden. The case argued that TDC was engaging in unconstitutional practices related to overcrowding and other prison conditions. Texas lost the case, and as a result, was forced to enter into a series of settlements. To amend the issue of overcrowding, the courts placed constraints on the number of inmates who could be placed in cells. To ensure compliance, TDC was put under court supervision until 2003.</p>
<p>Given these constraints, the construction of new prisons was the only way that Texas could keep arresting as many people as its police departments wanted to without having to release those whom the TDC had already imprisoned. If it didn’t build more prisons, the state would be forced to increase the number of people to whom it granted parole. That is precisely what happened; following <em>Ruiz v. Estelle</em>, Texas used parole more intensively.</p>
<p>But then, in the late 1980s, Texas Governor Bill Clements began building prisons. Later, in 1993, Texas Governor Ann Richards began building even more prisons. Under Richards, state legislators approved $1 billion for prison construction, which would double the state’s ability to imprison people within three years. This can be seen in Figure <a href="ch9.html#fig:texas1">10.7</a>.</p>
<div class="figure">
<span id="fig:texas1"></span>
<img src="graphics/capacity_operational_texas.jpg" alt="Prison capacity (operational capacity) expansion" width="100%"><p class="caption">
Figure 10.7: Prison capacity (operational capacity) expansion
</p>
</div>
<p>As can be seen, Clements’ prison capacity expansion projects were relatively small compared those by Richards. But Richards’s investments in “operational capacity,” or the ability to house prisoners, were gigantic. The number of prison beds available for the state to keep filling with prisoners grew more than 30% for three years, meaning that the number of prison beds more than doubled in just a short period of time.</p>
<p>What was the effect of building so many prisons? Just because prison capacity expands doesn’t mean incarceration will grow. But, among other reasons, because the state was intensively using paroles to handle the flow, that’s precisely what did happen. The analysis that follows will show the effect of this prison-building boom by the state of Texas on the incarceration of African American men.</p>
<div class="figure">
<span id="fig:texas2"></span>
<img src="graphics/bm_incarceration.jpg" alt="African-American male incarceration" width="100%"><p class="caption">
Figure 10.8: African-American male incarceration
</p>
</div>
<p>As you can see from Figure <a href="ch9.html#fig:texas2">10.8</a>, the incarceration rate of black men doubled in only three years. Texas basically went from being a typical, modal state when it came to incarceration to one of the most severe in only a short period.</p>
<p>What we will now do is analyze the effect that the prison construction under Governor Ann Richards had on the incarceration of black men using synthetic control. The R file is much more straightforward than the synthetic control file, which is broken up into several parts. I have therefore posted to Github both a texassynth.do file that will run all of this seamlessly, as well as a “Read Me” document to help you understand the directories and subdirectories needed do this. Let’s begin.</p>
<p>The first step is to create the figure showing the effect of the 1993 prison construction on the incarceration of black men. I’ve chosen a set of covariates and pre-treatment outcome variables for the matching; I encourage you, though, to play around with different models. We can already see from Figure <a href="ch9.html#fig:texas2">10.8</a> that prior to 1993, Texas Black male incarceration were pretty similar to the rest of the country. What this is going to mean for our analysis is that we have every reason to believe that the convex hull likely exists in this application.</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_1.do"><code>synth_1.do</code></a></em></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb101-1"><a href="ch9.html#cb101-1" aria-hidden="true"></a>cd /users/scott\_cunningham/downloads/texas/<span class="kw">do</span></span>
<span id="cb101-2"><a href="ch9.html#cb101-2" aria-hidden="true"></a>* Estimation 1: Texas <span class="kw">model</span> <span class="kw">of</span> <span class="bn">black</span> male prisoners (per capita) </span>
<span id="cb101-3"><a href="ch9.html#cb101-3" aria-hidden="true"></a><span class="kw">use</span> https:<span class="co">//github.com/scunning1975/mixtape/raw/master/texas.dta, clear</span></span>
<span id="cb101-4"><a href="ch9.html#cb101-4" aria-hidden="true"></a><span class="kw">ssc</span> install synth </span>
<span id="cb101-5"><a href="ch9.html#cb101-5" aria-hidden="true"></a><span class="kw">ssc</span> install mat2txt</span>
<span id="cb101-6"><a href="ch9.html#cb101-6" aria-hidden="true"></a>#delimit; </span>
<span id="cb101-7"><a href="ch9.html#cb101-7" aria-hidden="true"></a>synth   bmprison  </span>
<span id="cb101-8"><a href="ch9.html#cb101-8" aria-hidden="true"></a>            bmprison(1990) bmprison(1992) bmprison(1991) bmprison(1988)</span>
<span id="cb101-9"><a href="ch9.html#cb101-9" aria-hidden="true"></a>            alcohol(1990) aidscapita(1990) aidscapita(1991) </span>
<span id="cb101-10"><a href="ch9.html#cb101-10" aria-hidden="true"></a>            income ur poverty <span class="bn">black</span>(1990) <span class="bn">black</span>(1991) <span class="bn">black</span>(1992) </span>
<span id="cb101-11"><a href="ch9.html#cb101-11" aria-hidden="true"></a>            perc1519(1990)</span>
<span id="cb101-12"><a href="ch9.html#cb101-12" aria-hidden="true"></a>            ,       </span>
<span id="cb101-13"><a href="ch9.html#cb101-13" aria-hidden="true"></a>        trunit(48) trperiod(1993) unitnames(state) </span>
<span id="cb101-14"><a href="ch9.html#cb101-14" aria-hidden="true"></a>        mspeperiod(1985(1)1993) resultsperiod(1985(1)2000)</span>
<span id="cb101-15"><a href="ch9.html#cb101-15" aria-hidden="true"></a>        <span class="kw">keep</span>(../<span class="kw">data</span>/synth/synth\_bmprate.dta) <span class="kw">replace</span> fig;</span>
<span id="cb101-16"><a href="ch9.html#cb101-16" aria-hidden="true"></a>        mat <span class="ot">list</span> <span class="fu">e</span>(V_matrix);</span>
<span id="cb101-17"><a href="ch9.html#cb101-17" aria-hidden="true"></a>        #delimit <span class="kw">cr</span></span>
<span id="cb101-18"><a href="ch9.html#cb101-18" aria-hidden="true"></a>        <span class="kw">graph</span> <span class="kw">save</span> Graph ../Figures/synth\_tx.gph, <span class="kw">replace</span>}</span></code></pre></div>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/R/synth_1.R"><code>synth_1.R</code></a></em></p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haven.tidyverse.org">haven</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Synth</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">SCtools</span><span class="op">)</span><span class="op">)</span> <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"bcastanho/SCtools"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SCtools</span><span class="op">)</span>

<span class="va">read_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">full_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"https://raw.github.com/scunning1975/mixtape/master/"</span>, 
                     <span class="va">df</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html">read_dta</a></span><span class="op">(</span><span class="va">full_path</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">texas</span> <span class="op">&lt;-</span> <span class="fu">read_data</span><span class="op">(</span><span class="st">"texas.dta"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>

<span class="va">dataprep_out</span> <span class="op">&lt;-</span> <span class="fu">dataprep</span><span class="op">(</span>
  foo <span class="op">=</span> <span class="va">texas</span>,
  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"poverty"</span>, <span class="st">"income"</span><span class="op">)</span>,
  predictors.op <span class="op">=</span> <span class="st">"mean"</span>,
  time.predictors.prior <span class="op">=</span> <span class="fl">1985</span><span class="op">:</span><span class="fl">1993</span>,
  special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"bmprison"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1988</span>, <span class="fl">1990</span><span class="op">:</span><span class="fl">1992</span><span class="op">)</span>, <span class="st">"mean"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"alcohol"</span>, <span class="fl">1990</span>, <span class="st">"mean"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"aidscapita"</span>, <span class="fl">1990</span><span class="op">:</span><span class="fl">1991</span>, <span class="st">"mean"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">1990</span><span class="op">:</span><span class="fl">1992</span>, <span class="st">"mean"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"perc1519"</span>, <span class="fl">1990</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">)</span>,
  dependent <span class="op">=</span> <span class="st">"bmprison"</span>,
  unit.variable <span class="op">=</span> <span class="st">"statefip"</span>,
  unit.names.variable <span class="op">=</span> <span class="st">"state"</span>,
  time.variable <span class="op">=</span> <span class="st">"year"</span>,
  treatment.identifier <span class="op">=</span> <span class="fl">48</span>,
  controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">8</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">15</span><span class="op">:</span><span class="fl">42</span>,<span class="fl">44</span><span class="op">:</span><span class="fl">47</span>,<span class="fl">49</span><span class="op">:</span><span class="fl">51</span>,<span class="fl">53</span><span class="op">:</span><span class="fl">56</span><span class="op">)</span>,
  time.optimize.ssr <span class="op">=</span> <span class="fl">1985</span><span class="op">:</span><span class="fl">1993</span>,
  time.plot <span class="op">=</span> <span class="fl">1985</span><span class="op">:</span><span class="fl">2000</span>
<span class="op">)</span>

<span class="va">synth_out</span> <span class="op">&lt;-</span> <span class="fu">synth</span><span class="op">(</span>data.prep.obj <span class="op">=</span> <span class="va">dataprep_out</span><span class="op">)</span>

<span class="fu">path.plot</span><span class="op">(</span><span class="va">synth_out</span>, <span class="va">dataprep_out</span><span class="op">)</span></code></pre></div>
<p>Regarding the Stata syntax of this file: I personally prefer to make the delimiter a semicolon because I want to have all syntax for <code>synth</code> on the same screen. I’m more of a visual person, so that helps me. Next the <code>synth</code> syntax. The syntax goes like this: call <code>synth</code>, then call the outcome variable (bmprison), then the variables you want to match on. Notice that you can choose either to match on the entire pre-treatment average, or you can choose particular years. I choose both. Also recall that <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2010" role="doc-biblioref">2010</a>)</span> notes the importance of controlling for pre-treatment outcomes to soak up the heterogeneity; I do that here as well. Once you’ve listed your covariates, you use a comma to move to Stata options. You first have to specify the treatment unit. The FIPS code for Texas is a 48, hence the 48. You then specify the treatment period, which is 1993. You list the period of time which will be used to minimize the mean squared prediction error, as well as what years to display. Stata will produce both a figure as well as a data set with information used to create the figure. It will also list the <span class="math inline">\(V\)</span> matrix. Finally, I change the delimiter back to carriage return, and save the figure in the /Figures subdirectory. Let’s look at what these lines made (Figure <a href="ch9.html#fig:texas3">10.9</a>).</p>
<div class="figure">
<span id="fig:texas3"></span>
<img src="graphics/synth_tx.jpg" alt="African-American male incarceration" width="100%"><p class="caption">
Figure 10.9: African-American male incarceration
</p>
</div>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_2.do"><code>synth_2.do</code></a></em></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb103-1"><a href="ch9.html#cb103-1" aria-hidden="true"></a>* Plot the gap <span class="kw">in</span> predicted <span class="kw">error</span></span>
<span id="cb103-2"><a href="ch9.html#cb103-2" aria-hidden="true"></a><span class="kw">use</span> ../<span class="kw">data</span>/synth/synth_bmprate.dta, <span class="kw">clear</span></span>
<span id="cb103-3"><a href="ch9.html#cb103-3" aria-hidden="true"></a><span class="kw">keep</span> _Y_treated _Y_synthetic _time</span>
<span id="cb103-4"><a href="ch9.html#cb103-4" aria-hidden="true"></a><span class="kw">drop</span> <span class="kw">if</span> _time==.</span>
<span id="cb103-5"><a href="ch9.html#cb103-5" aria-hidden="true"></a><span class="kw">rename</span> _time <span class="fu">year</span></span>
<span id="cb103-6"><a href="ch9.html#cb103-6" aria-hidden="true"></a><span class="kw">rename</span> _Y_treated  treat</span>
<span id="cb103-7"><a href="ch9.html#cb103-7" aria-hidden="true"></a><span class="kw">rename</span> _Y_synthetic counterfact</span>
<span id="cb103-8"><a href="ch9.html#cb103-8" aria-hidden="true"></a><span class="kw">gen</span> gap48=treat-counterfact</span>
<span id="cb103-9"><a href="ch9.html#cb103-9" aria-hidden="true"></a><span class="kw">sort</span> <span class="fu">year</span></span>
<span id="cb103-10"><a href="ch9.html#cb103-10" aria-hidden="true"></a>#delimit ; </span>
<span id="cb103-11"><a href="ch9.html#cb103-11" aria-hidden="true"></a><span class="kw">twoway</span> (<span class="kw">line</span> gap48 <span class="fu">year</span>,lp(solid)lw(vthin)lcolor(<span class="bn">black</span>)), <span class="kw">yline</span>(0, lpattern(shortdash) lcolor(<span class="bn">black</span>)) </span>
<span id="cb103-12"><a href="ch9.html#cb103-12" aria-hidden="true"></a>    <span class="bn">xline</span>(1993, lpattern(shortdash) lcolor(<span class="bn">black</span>)) <span class="bn">xtitle</span>(<span class="st">""</span>,si(medsmall)) <span class="kw">xlabel</span>(#10) </span>
<span id="cb103-13"><a href="ch9.html#cb103-13" aria-hidden="true"></a>    <span class="bn">ytitle</span>(<span class="st">"Gap in black male prisoner prediction error"</span>, <span class="kw">size</span>(medsmall)) <span class="bn">legend</span>(<span class="kw">off</span>); </span>
<span id="cb103-14"><a href="ch9.html#cb103-14" aria-hidden="true"></a>    #delimit <span class="kw">cr</span></span>
<span id="cb103-15"><a href="ch9.html#cb103-15" aria-hidden="true"></a>    <span class="kw">save</span> ../<span class="kw">data</span>/synth/synth_bmprate_48.dta, <span class="kw">replace</span>}</span></code></pre></div>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/R/synth_2.R"><code>synth_2.R</code></a></em></p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">gaps.plot</span><span class="op">(</span><span class="va">synth_out</span>, <span class="va">dataprep_out</span><span class="op">)</span></code></pre></div>
<p>This is the kind of outcome that you ideally want to have specifically, a very similar pre-treatment trend in the synthetic Texas group compared to the actual Texas group, and a divergence in the post-treatment period. We will now plot the gap between these two lines using our programming commands in the accompanying code.</p>
<div class="figure">
<span id="fig:texas4"></span>
<img src="graphics/gap_tx.jpg" alt="Gap between actual Texas and synthetic Texas" width="100%"><p class="caption">
Figure 10.10: Gap between actual Texas and synthetic Texas
</p>
</div>
<p>The figure that this makes is shown in Figure <a href="ch9.html#fig:texas4">10.10</a>. It is essentially nothing more than the “gap” between Texas and synthetic Texas values, per year, in Figure <a href="ch9.html#fig:texas3">10.9</a>.</p>
<p>And finally, we will show the weights used to construct the synthetic Texas.</p>
<div class="inline-table"><table class="table table-sm">
<caption>Synthetic control weights</caption>
<thead><tr class="header">
<th align="left">State name</th>
<th align="center">Weights</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">California</td>
<td align="center">0.408</td>
</tr>
<tr class="even">
<td align="left">Florida</td>
<td align="center">0.109</td>
</tr>
<tr class="odd">
<td align="left">Illinois</td>
<td align="center">0.36</td>
</tr>
<tr class="even">
<td align="left">Louisiana</td>
<td align="center">0.122</td>
</tr>
</tbody>
</table></div>
<p>Now that we have our estimates of the causal effect, we move into the calculation of the exact <span class="math inline">\(p\)</span>-value, which will be based on assigning the treatment to every state and reestimating our model. Texas will always be thrown back into the donor pool each time. This next part will contain multiple Stata programs, but because of the efficiency of the R package, I will only produce one R program. So all exposition henceforth will focus on the Stata commands.</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_3.do"><code>synth_3.do</code></a></em></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb105-1"><a href="ch9.html#cb105-1" aria-hidden="true"></a>* Inference 1 placebo <span class="kw">test</span>  </span>
<span id="cb105-2"><a href="ch9.html#cb105-2" aria-hidden="true"></a>#delimit; </span>
<span id="cb105-3"><a href="ch9.html#cb105-3" aria-hidden="true"></a><span class="kw">set</span> <span class="kw">more</span> <span class="kw">off</span>; </span>
<span id="cb105-4"><a href="ch9.html#cb105-4" aria-hidden="true"></a><span class="kw">use</span> ../<span class="kw">data</span>/texas.dta, <span class="kw">replace</span>; </span>
<span id="cb105-5"><a href="ch9.html#cb105-5" aria-hidden="true"></a><span class="kw">local</span> statelist  1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 23 24 25 26 27 28 29 30 31 32  </span>
<span id="cb105-6"><a href="ch9.html#cb105-6" aria-hidden="true"></a>    33 34 35 36 37 38 39 40 41 42 45 46 47 48 49 51 53 55; </span>
<span id="cb105-7"><a href="ch9.html#cb105-7" aria-hidden="true"></a><span class="kw">foreach</span> i <span class="kw">of</span> <span class="kw">local</span> statelist {;</span>
<span id="cb105-8"><a href="ch9.html#cb105-8" aria-hidden="true"></a>synth   bmprison  </span>
<span id="cb105-9"><a href="ch9.html#cb105-9" aria-hidden="true"></a>        bmprison(1990) bmprison(1992) bmprison(1991) bmprison(1988) </span>
<span id="cb105-10"><a href="ch9.html#cb105-10" aria-hidden="true"></a>        alcohol(1990) aidscapita(1990) aidscapita(1991)  </span>
<span id="cb105-11"><a href="ch9.html#cb105-11" aria-hidden="true"></a>        income ur poverty <span class="bn">black</span>(1990) <span class="bn">black</span>(1991) <span class="bn">black</span>(1992)  </span>
<span id="cb105-12"><a href="ch9.html#cb105-12" aria-hidden="true"></a>        perc1519(1990) </span>
<span id="cb105-13"><a href="ch9.html#cb105-13" aria-hidden="true"></a>        ,        </span>
<span id="cb105-14"><a href="ch9.html#cb105-14" aria-hidden="true"></a>            trunit(<span class="ot">`i'</span>) trperiod(1993) unitnames(state)  </span>
<span id="cb105-15"><a href="ch9.html#cb105-15" aria-hidden="true"></a>            mspeperiod(1985(1)1993) resultsperiod(1985(1)2000) </span>
<span id="cb105-16"><a href="ch9.html#cb105-16" aria-hidden="true"></a>            <span class="kw">keep</span>(../<span class="kw">data</span>/synth/synth\_bmprate\_<span class="ot">`i'</span>.dta) <span class="kw">replace</span>; </span>
<span id="cb105-17"><a href="ch9.html#cb105-17" aria-hidden="true"></a>            <span class="fu">matrix</span> state<span class="ot">`i'</span> = <span class="fu">e</span>(RMSPE); <span class="co">/* check the V matrix*/</span> </span>
<span id="cb105-18"><a href="ch9.html#cb105-18" aria-hidden="true"></a></span>
<span id="cb105-19"><a href="ch9.html#cb105-19" aria-hidden="true"></a><span class="kw">foreach</span> i <span class="kw">of</span> <span class="kw">local</span> statelist {; </span>
<span id="cb105-20"><a href="ch9.html#cb105-20" aria-hidden="true"></a><span class="fu">matrix</span> <span class="ot">rownames</span> state<span class="ot">`i'</span>=<span class="ot">`i'</span>; </span>
<span id="cb105-21"><a href="ch9.html#cb105-21" aria-hidden="true"></a><span class="kw">matlist</span> state<span class="ot">`i'</span>, names(<span class="bn">rows</span>); </span>
<span id="cb105-22"><a href="ch9.html#cb105-22" aria-hidden="true"></a>};</span>
<span id="cb105-23"><a href="ch9.html#cb105-23" aria-hidden="true"></a>#delimit <span class="kw">cr</span></span></code></pre></div>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/R/synth_3_7.R"><code>synth_3_7.R</code></a></em></p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">placebos</span> <span class="op">&lt;-</span> <span class="fu">generate.placebos</span><span class="op">(</span><span class="va">dataprep_out</span>, <span class="va">synth_out</span>, Sigf.ipop <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="fu">plot_placebos</span><span class="op">(</span><span class="va">placebos</span><span class="op">)</span>

<span class="fu">mspe.plot</span><span class="op">(</span><span class="va">placebos</span>, discard.extreme <span class="op">=</span> <span class="cn">TRUE</span>, mspe.limit <span class="op">=</span> <span class="fl">1</span>, plot.hist <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This is a loop in which it will cycle through every state and estimate the model. It will then save data associated with each model into the ../data/synth/synth_bmcrate_‘i’.dta data file where ‘i’ is one of the state FIPS codes listed after local statelist. Now that we have each of these files, we can calculate the post-to-pre RMSPE.</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_4.do"><code>synth_4.do</code></a></em></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb107-1"><a href="ch9.html#cb107-1" aria-hidden="true"></a><span class="kw">local</span> statelist  1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 23 24 25 26 27 28 29 30 31 32 </span>
<span id="cb107-2"><a href="ch9.html#cb107-2" aria-hidden="true"></a>    33 34 35 36 37 38 39 40 41 42 45 46 47 48 49 51 53 55</span>
<span id="cb107-3"><a href="ch9.html#cb107-3" aria-hidden="true"></a> <span class="kw">foreach</span> i <span class="kw">of</span> <span class="kw">local</span> statelist {</span>
<span id="cb107-4"><a href="ch9.html#cb107-4" aria-hidden="true"></a>    <span class="kw">use</span> ../<span class="kw">data</span>/synth/synth_bmprate_<span class="ot">`i'</span> ,<span class="kw">clear</span></span>
<span id="cb107-5"><a href="ch9.html#cb107-5" aria-hidden="true"></a>    <span class="kw">keep</span> _Y_treated _Y_synthetic _time</span>
<span id="cb107-6"><a href="ch9.html#cb107-6" aria-hidden="true"></a>    <span class="kw">drop</span> <span class="kw">if</span> _time==.</span>
<span id="cb107-7"><a href="ch9.html#cb107-7" aria-hidden="true"></a>    <span class="kw">rename</span> _time <span class="fu">year</span></span>
<span id="cb107-8"><a href="ch9.html#cb107-8" aria-hidden="true"></a>    <span class="kw">rename</span> _Y_treated  treat<span class="ot">`i'</span></span>
<span id="cb107-9"><a href="ch9.html#cb107-9" aria-hidden="true"></a>    <span class="kw">rename</span> _Y_synthetic counterfact<span class="ot">`i'</span></span>
<span id="cb107-10"><a href="ch9.html#cb107-10" aria-hidden="true"></a>    <span class="kw">gen</span> gap<span class="ot">`i'</span>=treat<span class="ot">`i'</span>-counterfact<span class="ot">`i'</span></span>
<span id="cb107-11"><a href="ch9.html#cb107-11" aria-hidden="true"></a>    <span class="kw">sort</span> <span class="fu">year</span> </span>
<span id="cb107-12"><a href="ch9.html#cb107-12" aria-hidden="true"></a>    <span class="kw">save</span> ../<span class="kw">data</span>/synth/synth_gap_bmprate<span class="ot">`i'</span>, <span class="kw">replace</span></span>
<span id="cb107-13"><a href="ch9.html#cb107-13" aria-hidden="true"></a>    }</span>
<span id="cb107-14"><a href="ch9.html#cb107-14" aria-hidden="true"></a><span class="kw">use</span> ../<span class="kw">data</span>/synth/synth_gap_bmprate48.dta, <span class="kw">clear</span></span>
<span id="cb107-15"><a href="ch9.html#cb107-15" aria-hidden="true"></a><span class="kw">sort</span> <span class="fu">year</span></span>
<span id="cb107-16"><a href="ch9.html#cb107-16" aria-hidden="true"></a><span class="kw">save</span> ../<span class="kw">data</span>/synth/placebo_bmprate48.dta, <span class="kw">replace</span></span>
<span id="cb107-17"><a href="ch9.html#cb107-17" aria-hidden="true"></a></span>
<span id="cb107-18"><a href="ch9.html#cb107-18" aria-hidden="true"></a><span class="kw">foreach</span> i <span class="kw">of</span> <span class="kw">local</span> statelist {</span>
<span id="cb107-19"><a href="ch9.html#cb107-19" aria-hidden="true"></a>        <span class="kw">merge</span> <span class="fu">year</span> <span class="kw">using</span> ../<span class="kw">data</span>/synth/synth_gap_bmprate<span class="ot">`i'</span> </span>
<span id="cb107-20"><a href="ch9.html#cb107-20" aria-hidden="true"></a>        <span class="kw">drop</span> <span class="dt">_merge</span> </span>
<span id="cb107-21"><a href="ch9.html#cb107-21" aria-hidden="true"></a>        <span class="kw">sort</span> <span class="fu">year</span> </span>
<span id="cb107-22"><a href="ch9.html#cb107-22" aria-hidden="true"></a>    <span class="kw">save</span> ../<span class="kw">data</span>/synth/placebo_bmprate.dta, <span class="kw">replace</span> </span>
<span id="cb107-23"><a href="ch9.html#cb107-23" aria-hidden="true"></a>    }</span>
<span id="cb107-24"><a href="ch9.html#cb107-24" aria-hidden="true"></a>    </span></code></pre></div>
<p>Notice that this is going to first create the gap between the treatment state and the counterfactual state before merging each of them into a single data file.</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_5.do"><code>synth_5.do</code></a></em></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb108-1"><a href="ch9.html#cb108-1" aria-hidden="true"></a>** Inference 2: Estimate the pre- and <span class="kw">post</span>-RMSPE and calculate the <span class="kw">ratio</span> <span class="kw">of</span> the</span>
<span id="cb108-2"><a href="ch9.html#cb108-2" aria-hidden="true"></a>*  <span class="kw">post</span>-pre RMSPE   </span>
<span id="cb108-3"><a href="ch9.html#cb108-3" aria-hidden="true"></a><span class="kw">set</span> <span class="kw">more</span> <span class="kw">off</span></span>
<span id="cb108-4"><a href="ch9.html#cb108-4" aria-hidden="true"></a><span class="kw">local</span> statelist  1 2 4 5 6 8 9 10 11 12 13 15 16 17 18 20 21 22 23 24 25 26 27 28 29 30 31 32 </span>
<span id="cb108-5"><a href="ch9.html#cb108-5" aria-hidden="true"></a>    33 34 35 36 37 38 39 40 41 42 45 46 47 48 49 51 53 55</span>
<span id="cb108-6"><a href="ch9.html#cb108-6" aria-hidden="true"></a><span class="kw">foreach</span> i <span class="kw">of</span> <span class="kw">local</span> statelist {</span>
<span id="cb108-7"><a href="ch9.html#cb108-7" aria-hidden="true"></a></span>
<span id="cb108-8"><a href="ch9.html#cb108-8" aria-hidden="true"></a>    <span class="kw">use</span> ../<span class="kw">data</span>/synth/synth_gap_bmprate<span class="ot">`i'</span>, <span class="kw">clear</span></span>
<span id="cb108-9"><a href="ch9.html#cb108-9" aria-hidden="true"></a>    <span class="kw">gen</span> gap3=gap<span class="ot">`i'</span>*gap<span class="ot">`i'</span></span>
<span id="cb108-10"><a href="ch9.html#cb108-10" aria-hidden="true"></a>    <span class="kw">egen</span> postmean=<span class="kw">mean</span>(gap3) <span class="kw">if</span> <span class="fu">year</span>&gt;1993</span>
<span id="cb108-11"><a href="ch9.html#cb108-11" aria-hidden="true"></a>    <span class="kw">egen</span> premean=<span class="kw">mean</span>(gap3) <span class="kw">if</span> <span class="fu">year</span>&lt;=1993</span>
<span id="cb108-12"><a href="ch9.html#cb108-12" aria-hidden="true"></a>    <span class="kw">gen</span> rmspe=<span class="fu">sqrt</span>(premean) <span class="kw">if</span> <span class="fu">year</span>&lt;=1993</span>
<span id="cb108-13"><a href="ch9.html#cb108-13" aria-hidden="true"></a>    <span class="kw">replace</span> rmspe=<span class="fu">sqrt</span>(postmean) <span class="kw">if</span> <span class="fu">year</span>&gt;1993</span>
<span id="cb108-14"><a href="ch9.html#cb108-14" aria-hidden="true"></a>    <span class="kw">gen</span> <span class="kw">ratio</span>=rmspe/rmspe[<span class="dt">_n</span>-1] <span class="kw">if</span> 1994</span>
<span id="cb108-15"><a href="ch9.html#cb108-15" aria-hidden="true"></a>    <span class="kw">gen</span> rmspe_post=<span class="fu">sqrt</span>(postmean) <span class="kw">if</span> <span class="fu">year</span>&gt;1993</span>
<span id="cb108-16"><a href="ch9.html#cb108-16" aria-hidden="true"></a>    <span class="kw">gen</span> rmspe_pre=rmspe[<span class="dt">_n</span>-1] <span class="kw">if</span> 1994</span>
<span id="cb108-17"><a href="ch9.html#cb108-17" aria-hidden="true"></a>    <span class="kw">mkmat</span> rmspe_pre rmspe_post <span class="kw">ratio</span> <span class="kw">if</span> 1994, <span class="fu">matrix</span> (state<span class="ot">`i'</span>)</span></code></pre></div>
<p>In this part, we are calculating the post-RMSPE, the pre-RMSPE, and the ratio of the two. Once we have this information, we can compute a histogram. The following commands do that.</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_6.do"><code>synth_6.do</code></a></em></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb109-1"><a href="ch9.html#cb109-1" aria-hidden="true"></a>* show <span class="kw">post</span>/pre-expansion RMSPE <span class="kw">ratio</span> <span class="kw">for</span> <span class="ot">all</span> states, <span class="kw">generate</span> <span class="kw">histogram</span></span>
<span id="cb109-2"><a href="ch9.html#cb109-2" aria-hidden="true"></a>    <span class="kw">foreach</span> i <span class="kw">of</span> <span class="kw">local</span> statelist {</span>
<span id="cb109-3"><a href="ch9.html#cb109-3" aria-hidden="true"></a>        <span class="fu">matrix</span> <span class="ot">rownames</span> state<span class="ot">`i'</span>=<span class="ot">`i'</span></span>
<span id="cb109-4"><a href="ch9.html#cb109-4" aria-hidden="true"></a>        <span class="kw">matlist</span> state<span class="ot">`i'</span>, names(<span class="bn">rows</span>)</span>
<span id="cb109-5"><a href="ch9.html#cb109-5" aria-hidden="true"></a>                                    }</span>
<span id="cb109-6"><a href="ch9.html#cb109-6" aria-hidden="true"></a>#delimit ;</span>
<span id="cb109-7"><a href="ch9.html#cb109-7" aria-hidden="true"></a>matstate=state1/state2/state4/state5/state6/state8/state9/state10/state11/state12/state13/state15/state16/state17/state18/state20/state21/state22/state23/state24/state25/state26/state27/state28/state29/state30/state31/state32/state33/state34/state35/state36/state37/state38/state39/state40/state41/state42/state45/state46/state47/state48/state49/state51/state53/state55; </span>
<span id="cb109-8"><a href="ch9.html#cb109-8" aria-hidden="true"></a>#delimit <span class="kw">cr</span></span>
<span id="cb109-9"><a href="ch9.html#cb109-9" aria-hidden="true"></a>* <span class="kw">ssc</span> install mat2txt</span>
<span id="cb109-10"><a href="ch9.html#cb109-10" aria-hidden="true"></a>    mat2txt, <span class="fu">matrix</span>(state) <span class="kw">saving</span>(../inference/rmspe_bmprate.txt) <span class="kw">replace</span></span>
<span id="cb109-11"><a href="ch9.html#cb109-11" aria-hidden="true"></a>    <span class="kw">insheet</span> <span class="kw">using</span> ../inference/rmspe_bmprate.txt, <span class="kw">clear</span></span>
<span id="cb109-12"><a href="ch9.html#cb109-12" aria-hidden="true"></a>    <span class="kw">ren</span> v1 state</span>
<span id="cb109-13"><a href="ch9.html#cb109-13" aria-hidden="true"></a>    <span class="kw">drop</span> v5</span>
<span id="cb109-14"><a href="ch9.html#cb109-14" aria-hidden="true"></a>    <span class="kw">gsort</span> -<span class="kw">ratio</span></span>
<span id="cb109-15"><a href="ch9.html#cb109-15" aria-hidden="true"></a>    <span class="kw">gen</span> <span class="fu">rank</span>=<span class="dt">_n</span></span>
<span id="cb109-16"><a href="ch9.html#cb109-16" aria-hidden="true"></a>    <span class="kw">gen</span> <span class="kw">p</span>=<span class="fu">rank</span>/46</span>
<span id="cb109-17"><a href="ch9.html#cb109-17" aria-hidden="true"></a>    <span class="kw">export</span> excel <span class="kw">using</span> ../inference/rmspe_bmprate, firstrow(variables) <span class="kw">replace</span></span>
<span id="cb109-18"><a href="ch9.html#cb109-18" aria-hidden="true"></a>    import excel ../inference/rmspe_bmprate.xls, sheet(<span class="st">"Sheet1"</span>) firstrow <span class="kw">clear</span></span>
<span id="cb109-19"><a href="ch9.html#cb109-19" aria-hidden="true"></a>    <span class="kw">histogram</span> <span class="kw">ratio</span>, <span class="bn">bin</span>(20) <span class="kw">frequency</span> fcolor(gs13) lcolor(<span class="bn">black</span>) <span class="kw">ylabel</span>(0(2)6) </span>
<span id="cb109-20"><a href="ch9.html#cb109-20" aria-hidden="true"></a>    <span class="bn">xtitle</span>(Post/pre RMSPE <span class="kw">ratio</span>) <span class="kw">xlabel</span>(0(1)5)</span>
<span id="cb109-21"><a href="ch9.html#cb109-21" aria-hidden="true"></a>* Show the <span class="kw">post</span>/pre RMSPE <span class="kw">ratio</span> <span class="kw">for</span> <span class="ot">all</span> states, <span class="kw">generate</span> the <span class="kw">histogram</span>.</span>
<span id="cb109-22"><a href="ch9.html#cb109-22" aria-hidden="true"></a>    <span class="ot">list</span> <span class="fu">rank</span> <span class="kw">p</span> <span class="kw">if</span> state==48</span></code></pre></div>
<div class="figure">
<span id="fig:texas5"></span>
<img src="graphics/hist_tx.jpg" alt="Histogram of the distribution of ratios of post-RMSPE to pre-RMSPE. Texas is one of the ones in the far right tail." width="100%"><p class="caption">
Figure 10.11: Histogram of the distribution of ratios of post-RMSPE to pre-RMSPE. Texas is one of the ones in the far right tail.
</p>
</div>
<p>All the looping will take a few moments to run, but once it is done, it will produce a histogram of the distribution of ratios of post-RMSPE to pre-RMSPE. As you can see from the <span class="math inline">\(p\)</span>-value, Texas has the second-highest ratio out of forty-six state units, giving it a <span class="math inline">\(p\)</span>-value of 0.04. We can see that in Figure <a href="ch9.html#fig:texas5">10.11</a>.</p>
<p>Notice that in addition to the figure, this created an Excel spreadsheet containing information on the pre-RMSPE, the post-RMSPE, the ratio, and the rank. We will want to use that again when we limit our display next to states whose pre-RMSPE are similar to that of Texas.</p>
<p>Now we want to create the characteristic placebo graph where all the state placebos are laid on top of Texas. To do that, we can use some simple syntax contained in the Stata code:</p>
<p><em><a href="https://github.com/scunning1975/mixtape/blob/master/Do/synth_7.do"><code>synth_7.do</code></a></em></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode stata"><code class="sourceCode stata"><span id="cb110-1"><a href="ch9.html#cb110-1" aria-hidden="true"></a>* Inference 3: <span class="ot">all</span> the placeboes <span class="kw">on</span> the same picture</span>
<span id="cb110-2"><a href="ch9.html#cb110-2" aria-hidden="true"></a><span class="kw">use</span> ../<span class="kw">data</span>/synth/placebo_bmprate.dta, <span class="kw">replace</span></span>
<span id="cb110-3"><a href="ch9.html#cb110-3" aria-hidden="true"></a>* Picture <span class="kw">of</span> the full <span class="kw">sample</span>, including outlier RSMPE</span>
<span id="cb110-4"><a href="ch9.html#cb110-4" aria-hidden="true"></a>#delimit;   </span>
<span id="cb110-5"><a href="ch9.html#cb110-5" aria-hidden="true"></a><span class="kw">twoway</span> </span>
<span id="cb110-6"><a href="ch9.html#cb110-6" aria-hidden="true"></a>(<span class="kw">line</span> gap1 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-7"><a href="ch9.html#cb110-7" aria-hidden="true"></a>(<span class="kw">line</span> gap2 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-8"><a href="ch9.html#cb110-8" aria-hidden="true"></a>(<span class="kw">line</span> gap4 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-9"><a href="ch9.html#cb110-9" aria-hidden="true"></a>(<span class="kw">line</span> gap5 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-10"><a href="ch9.html#cb110-10" aria-hidden="true"></a>(<span class="kw">line</span> gap6 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-11"><a href="ch9.html#cb110-11" aria-hidden="true"></a>(<span class="kw">line</span> gap8 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-12"><a href="ch9.html#cb110-12" aria-hidden="true"></a>(<span class="kw">line</span> gap9 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-13"><a href="ch9.html#cb110-13" aria-hidden="true"></a>(<span class="kw">line</span> gap10 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-14"><a href="ch9.html#cb110-14" aria-hidden="true"></a>(<span class="kw">line</span> gap11 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-15"><a href="ch9.html#cb110-15" aria-hidden="true"></a>(<span class="kw">line</span> gap12 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-16"><a href="ch9.html#cb110-16" aria-hidden="true"></a>(<span class="kw">line</span> gap13 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-17"><a href="ch9.html#cb110-17" aria-hidden="true"></a>(<span class="kw">line</span> gap15 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-18"><a href="ch9.html#cb110-18" aria-hidden="true"></a>(<span class="kw">line</span> gap16 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-19"><a href="ch9.html#cb110-19" aria-hidden="true"></a>(<span class="kw">line</span> gap17 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-20"><a href="ch9.html#cb110-20" aria-hidden="true"></a>(<span class="kw">line</span> gap18 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-21"><a href="ch9.html#cb110-21" aria-hidden="true"></a>(<span class="kw">line</span> gap20 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-22"><a href="ch9.html#cb110-22" aria-hidden="true"></a>(<span class="kw">line</span> gap21 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-23"><a href="ch9.html#cb110-23" aria-hidden="true"></a>(<span class="kw">line</span> gap22 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-24"><a href="ch9.html#cb110-24" aria-hidden="true"></a>(<span class="kw">line</span> gap23 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-25"><a href="ch9.html#cb110-25" aria-hidden="true"></a>(<span class="kw">line</span> gap24 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-26"><a href="ch9.html#cb110-26" aria-hidden="true"></a>(<span class="kw">line</span> gap25 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-27"><a href="ch9.html#cb110-27" aria-hidden="true"></a>(<span class="kw">line</span> gap26 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-28"><a href="ch9.html#cb110-28" aria-hidden="true"></a>(<span class="kw">line</span> gap27 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-29"><a href="ch9.html#cb110-29" aria-hidden="true"></a>(<span class="kw">line</span> gap28 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-30"><a href="ch9.html#cb110-30" aria-hidden="true"></a>(<span class="kw">line</span> gap29 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-31"><a href="ch9.html#cb110-31" aria-hidden="true"></a>(<span class="kw">line</span> gap30 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-32"><a href="ch9.html#cb110-32" aria-hidden="true"></a>(<span class="kw">line</span> gap31 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-33"><a href="ch9.html#cb110-33" aria-hidden="true"></a>(<span class="kw">line</span> gap32 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-34"><a href="ch9.html#cb110-34" aria-hidden="true"></a>(<span class="kw">line</span> gap33 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-35"><a href="ch9.html#cb110-35" aria-hidden="true"></a>(<span class="kw">line</span> gap34 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-36"><a href="ch9.html#cb110-36" aria-hidden="true"></a>(<span class="kw">line</span> gap35 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-37"><a href="ch9.html#cb110-37" aria-hidden="true"></a>(<span class="kw">line</span> gap36 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-38"><a href="ch9.html#cb110-38" aria-hidden="true"></a>(<span class="kw">line</span> gap37 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-39"><a href="ch9.html#cb110-39" aria-hidden="true"></a>(<span class="kw">line</span> gap38 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-40"><a href="ch9.html#cb110-40" aria-hidden="true"></a>(<span class="kw">line</span> gap39 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-41"><a href="ch9.html#cb110-41" aria-hidden="true"></a>(<span class="kw">line</span> gap40 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-42"><a href="ch9.html#cb110-42" aria-hidden="true"></a>(<span class="kw">line</span> gap41 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-43"><a href="ch9.html#cb110-43" aria-hidden="true"></a>(<span class="kw">line</span> gap42 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-44"><a href="ch9.html#cb110-44" aria-hidden="true"></a>(<span class="kw">line</span> gap45 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-45"><a href="ch9.html#cb110-45" aria-hidden="true"></a>(<span class="kw">line</span> gap46 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-46"><a href="ch9.html#cb110-46" aria-hidden="true"></a>(<span class="kw">line</span> gap47 <span class="fu">year</span> ,lp(solid)lw(vthin))</span>
<span id="cb110-47"><a href="ch9.html#cb110-47" aria-hidden="true"></a>(<span class="kw">line</span> gap49 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-48"><a href="ch9.html#cb110-48" aria-hidden="true"></a>(<span class="kw">line</span> gap51 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-49"><a href="ch9.html#cb110-49" aria-hidden="true"></a>(<span class="kw">line</span> gap53 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-50"><a href="ch9.html#cb110-50" aria-hidden="true"></a>(<span class="kw">line</span> gap55 <span class="fu">year</span> ,lp(solid)lw(vthin)) </span>
<span id="cb110-51"><a href="ch9.html#cb110-51" aria-hidden="true"></a>(<span class="kw">line</span> gap48 <span class="fu">year</span> ,lp(solid)lw(thick)lcolor(<span class="bn">black</span>)), <span class="co">/*treatment unit, Texas*/</span></span>
<span id="cb110-52"><a href="ch9.html#cb110-52" aria-hidden="true"></a><span class="kw">yline</span>(0, lpattern(shortdash) lcolor(<span class="bn">black</span>)) <span class="bn">xline</span>(1993, lpattern(shortdash) lcolor(<span class="bn">black</span>))</span>
<span id="cb110-53"><a href="ch9.html#cb110-53" aria-hidden="true"></a><span class="bn">xtitle</span>(<span class="st">""</span>,si(small)) <span class="kw">xlabel</span>(#10) <span class="bn">ytitle</span>(<span class="st">"Gap in black male prisoners prediction error"</span>, <span class="kw">size</span>(small))</span>
<span id="cb110-54"><a href="ch9.html#cb110-54" aria-hidden="true"></a>    <span class="bn">legend</span>(<span class="kw">off</span>);</span>
<span id="cb110-55"><a href="ch9.html#cb110-55" aria-hidden="true"></a>#delimit <span class="kw">cr</span></span></code></pre></div>
<p>Here we will only display the main picture with the placebos, though one could show several cuts of the data in which you drop states whose pre-treatment fit compared to Texas is rather poor.</p>
<div class="figure">
<span id="fig:texas6"></span>
<img src="graphics/synth_placebo_bmprate.jpg" alt="Placebo distribution. Texas is the black line." width="100%"><p class="caption">
Figure 10.12: Placebo distribution. Texas is the black line.
</p>
</div>
<p>Now that you have seen how to use this .do file to estimate a synthetic control model, you are ready to play around with the data yourself. All of this analysis so far has used black male (total counts) incarceration as the dependent variable, but perhaps the results would be different if we used black male incarceration. That information is contained in the data set. I would like for you to do your own analysis using the black male incarceration rate variable as the dependent variable. You will need to find a new model to fit this pattern, as it’s unlikely that the one we used for levels will do as good a job describing rates as it did levels. In addition, you should implement the placebo-date falsification exercise that we mentioned from <span class="citation">Abadie, Diamond, and Hainmueller (<a href="references.html#ref-Abadie2015" role="doc-biblioref">2015</a>)</span>. Choose 1989 as your treatment date and 1992 as the end of the sample, and check whether the same model shows the same treatment effect as you found when you used the correct year, 1993, as the treatment date. I encourage you to use these data and this file to learn the ins and outs of the procedure itself, as well as to think more deeply about what synthetic control is doing and how to best use it in research.</p>
<div id="conclusion-8" class="section level3" number="10.2.1">
<h3>
<span class="header-section-number">10.2.1</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-8"><i class="fas fa-link"></i></a>
</h3>
<p>In conclusion, we have seen how to estimate synthetic control models in Stata. This model is currently an active area of research, and so I have decided to wait until subsequent editions to dive into the new material as many questions are unsettled. This chapter therefore is a good foundation for understanding the model and the practices around implementing it, including code in <span class="math inline">\(R\)</span> and Stata to do so. I hope that you find this useful.</p>
<div class="cover-box">
<div class="row">
    <div class="col-xs-8 col-md-4 cover-img">
        <a href="https://www.amazon.com/dp/0300251688"><img src="../images/cover.jpg" alt="Buy Today!"></a>
    </div>
    
    <div class="col-xs-12 col-md-8 cover-text-box">
            <h2> 
                Causal Inference: 
                <br><span style="font-style: italic; font-weight:bold; font-size: 20px;">The Mixtape.</span>
            </h2> 
            
        <div class="cover-text">
            <p>Buy the print version today:</p>
            
            <div class="chips">
                <a href="https://www.amazon.com/dp/0300251688" class="app-chip"> 
                    <i class="fab fa-amazon" aria-hidden="true"></i> Buy from Amazon 
                </a>
    
                <a href="https://yalebooks.yale.edu/book/9780300251685/causal-inference" class="app-chip"> 
                    <i class="fas fa-book" aria-hidden="true"></i> Buy from Yale Press 
                </a>
            </div>
        </div>
    </div>
</div>
</div>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="ch8.html"><span class="header-section-number">9</span> Difference-in-Differences</a></div>
<div class="next"><a href="ch10.html"><span class="header-section-number">11</span> Conclusion</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ch9"><span class="header-section-number">10</span> Synthetic Control</a></li>
<li>
<a class="nav-link" href="#introducing-the-comparative-case-study"><span class="header-section-number">10.1</span> Introducing the Comparative Case Study</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cuba-miami-and-the-mariel-boatlift"><span class="header-section-number">10.1.1</span> Cuba, Miami, and the Mariel Boatlift</a></li>
<li><a class="nav-link" href="#picking-synthetic-controls"><span class="header-section-number">10.1.2</span> Picking synthetic controls</a></li>
<li><a class="nav-link" href="#formalization"><span class="header-section-number">10.1.3</span> Formalization</a></li>
<li><a class="nav-link" href="#californias-proposition-99"><span class="header-section-number">10.1.4</span> California’s Proposition 99</a></li>
<li><a class="nav-link" href="#falsifications"><span class="header-section-number">10.1.5</span> Falsifications</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#prison-construction-and-black-male-incarceration"><span class="header-section-number">10.2</span> Prison Construction and Black Male Incarceration</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#conclusion-8"><span class="header-section-number">10.2.1</span> Conclusion</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/scunning1975/mixtape/blob/master/09-Synthetic_Control.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/scunning1975/mixtape/edit/master/09-Synthetic_Control.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><span style="font-weight:bold">Causal Inference</span></strong>: <i>The Mixtape</i>" was written by Scott Cunningham. It was last built on 2020-12-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
